"use strict";(self.webpackChunkdepinfo_template=self.webpackChunkdepinfo_template||[]).push([[439],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=u(n),c=r,k=p["".concat(s,".").concat(c)]||p[c]||m[c]||l;return n?a.createElement(k,i(i({ref:t},d),{},{components:n})):a.createElement(k,i({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[p]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),r=n(6010);const l={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(l.tabItem,i),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(7462),r=n(7294),l=n(6010),i=n(2466),o=n(6550),s=n(1980),u=n(7392),d=n(12);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function m(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function c(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function k(e){let{queryString:t=!1,groupId:n}=e;const a=(0,o.k6)(),l=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(l),(0,r.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(a.location.search);t.set(l,e),a.replace({...a.location,search:t.toString()})}),[l,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,l=m(e),[i,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!c({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:l}))),[s,u]=k({queryString:n,groupId:a}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,l]=(0,d.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&l.set(e)}),[n,l])]}({groupId:a}),N=(()=>{const e=s??p;return c({value:e,tabValues:l})?e:null})();(0,r.useLayoutEffect)((()=>{N&&o(N)}),[N]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!c({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),g(e)}),[u,g,l]),tabValues:l}}var N=n(2389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:u}=e;const d=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),m=e=>{const t=e.currentTarget,n=d.indexOf(t),a=u[n].value;a!==o&&(p(t),s(a))},c=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=d.indexOf(e.currentTarget)+1;t=d[n]??d[0];break}case"ArrowLeft":{const n=d.indexOf(e.currentTarget)-1;t=d[n]??d[d.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>d.push(e),onKeyDown:c,onClick:m},i,{className:(0,l.Z)("tabs__item",b.tabItem,i?.className,{"tabs__item--active":o===t})}),n??t)})))}function f(e){let{lazy:t,children:n,selectedValue:a}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function A(e){const t=g(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",b.tabList)},r.createElement(v,(0,a.Z)({},e,t)),r.createElement(f,(0,a.Z)({},e,t)))}function h(e){const t=(0,N.Z)();return r.createElement(A,(0,a.Z)({key:String(t)},e))}},5781:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>N,frontMatter:()=>o,metadata:()=>u,toc:()=>p});var a=n(7462),r=(n(7294),n(3905)),l=n(4866),i=n(5162);const o={title:"R05 - Gestion des comptes",slug:"05",draft:!1},s="Rencontre 5 - Gestion des comptes",u={unversionedId:"cours/r05",id:"cours/r05",title:"R05 - Gestion des comptes",description:"1. Rappel du cours pr\xe9c\xe9dent",source:"@site/docs/cours/r05.md",sourceDirName:"cours",slug:"/cours/05",permalink:"/b64-scriptage-sous-windows/cours/05",draft:!1,tags:[],version:"current",frontMatter:{title:"R05 - Gestion des comptes",slug:"05",draft:!1},sidebar:"docs",previous:{title:"R04 - Param\xe8tres, fonctions, fichiers et strings",permalink:"/b64-scriptage-sous-windows/cours/04"}},d={},p=[{value:"Gestion des comptes locaux",id:"gestion-des-comptes-locaux",level:2},{value:"Consulter les utilisateurs existants",id:"consulter-les-utilisateurs-existants",level:3},{value:"Cr\xe9ation d&#39;un nouvel utilisateur",id:"cr\xe9ation-dun-nouvel-utilisateur",level:3},{value:"Groupes locaux",id:"groupes-locaux",level:3},{value:"Gestion des comptes du domaine",id:"gestion-des-comptes-du-domaine",level:2},{value:"Outils RSAT",id:"outils-rsat",level:3},{value:"Installer RSAT sous Windows Server",id:"installer-rsat-sous-windows-server",level:4},{value:"Installer RSAT sous Windows 10/11",id:"installer-rsat-sous-windows-1011",level:4},{value:"Module PowerShell pour ADDS",id:"module-powershell-pour-adds",level:4},{value:"Informations sur le domaine et la for\xeat",id:"informations-sur-le-domaine-et-la-for\xeat",level:3},{value:"Unit\xe9s d&#39;organisation",id:"unit\xe9s-dorganisation",level:3},{value:"Recherche d&#39;une unit\xe9 d&#39;organisation",id:"recherche-dune-unit\xe9-dorganisation",level:4},{value:"Cr\xe9ation d&#39;une unit\xe9 d&#39;organisation",id:"cr\xe9ation-dune-unit\xe9-dorganisation",level:4},{value:"Comptes utilisateurs",id:"comptes-utilisateurs",level:3},{value:"Recherche d&#39;un compte utilisateur",id:"recherche-dun-compte-utilisateur",level:4},{value:"V\xe9rification de l&#39;existence d&#39;un compte utilisateur",id:"v\xe9rification-de-lexistence-dun-compte-utilisateur",level:4},{value:"Cr\xe9ation d&#39;un nouveau compte utilisateur",id:"cr\xe9ation-dun-nouveau-compte-utilisateur",level:4},{value:"Modification d&#39;un compte utilisateur existant",id:"modification-dun-compte-utilisateur-existant",level:4},{value:"Suppression d&#39;un compte utilisateur",id:"suppression-dun-compte-utilisateur",level:4},{value:"Groupes",id:"groupes",level:3},{value:"Recherche d&#39;un groupe",id:"recherche-dun-groupe",level:4},{value:"V\xe9rification de l&#39;existence d&#39;un groupe",id:"v\xe9rification-de-lexistence-dun-groupe",level:4},{value:"Cr\xe9ation d&#39;un nouveau groupe",id:"cr\xe9ation-dun-nouveau-groupe",level:4},{value:"Membres de groupes",id:"membres-de-groupes",level:3},{value:"Obtention des membres d&#39;un groupe",id:"obtention-des-membres-dun-groupe",level:4},{value:"Ajout de membres \xe0 un groupe",id:"ajout-de-membres-\xe0-un-groupe",level:4},{value:"Retrait de membres \xe0 un groupe",id:"retrait-de-membres-\xe0-un-groupe",level:4},{value:"Attributs",id:"attributs",level:3},{value:"Outils suppl\xe9mentaires",id:"outils-suppl\xe9mentaires",level:3},{value:"Fonctionnalit\xe9s avanc\xe9es de la console ADUC",id:"fonctionnalit\xe9s-avanc\xe9es-de-la-console-aduc",level:4},{value:"ADSI Edit",id:"adsi-edit",level:4},{value:"ADExplorer (Sysinternals)",id:"adexplorer-sysinternals",level:4},{value:"Module AdsiPS",id:"module-adsips",level:4},{value:"EXTRA: SID, RID et principaux de s\xe9curit\xe9",id:"extra-sid-rid-et-principaux-de-s\xe9curit\xe9",level:2},{value:"Principaux de s\xe9curit\xe9 Active Directory",id:"principaux-de-s\xe9curit\xe9-active-directory",level:3},{value:"Groupes de s\xe9curit\xe9 locaux",id:"groupes-de-s\xe9curit\xe9-locaux",level:3}],m=(c="PowerShellWindow",function(e){return console.warn("Component "+c+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var c;const k={toc:p},g="wrapper";function N(e){let{components:t,...o}=e;return(0,r.kt)(g,(0,a.Z)({},k,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"rencontre-5---gestion-des-comptes"},"Rencontre 5 - Gestion des comptes"),(0,r.kt)("admonition",{title:"R\xe9sum\xe9 de la s\xe9ance",type:"note"},(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"deroulement",label:"\ud83d\udc68\u200d\ud83c\udfeb D\xe9roulement du cours",mdxType:"TabItem"},(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"Rappel du cours pr\xe9c\xe9dent"),(0,r.kt)("li",{parentName:"ol"},"Gestion des comptes locaux"),(0,r.kt)("li",{parentName:"ol"},"Gestion des comptes de domaine"),(0,r.kt)("li",{parentName:"ol"},"Git"),(0,r.kt)("li",{parentName:"ol"},"Pr\xe9sentation du TP1"))),(0,r.kt)(i.Z,{value:"exercices",label:"\ud83d\udcbb Exercices \xe0 compl\xe9ter",mdxType:"TabItem"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Travail pratique 1"))),(0,r.kt)(i.Z,{value:"ressources",label:"\ud83d\udcda Ressources \xe0 consulter",mdxType:"TabItem"},(0,r.kt)("p",{parentName:"admonition"},"La pr\xe9sentation PowerPoint est sur le Teams du cours, sous le canal G\xe9n\xe9ral > Fichiers > Supports de cours.")))),(0,r.kt)("h2",{id:"gestion-des-comptes-locaux"},"Gestion des comptes locaux"),(0,r.kt)("p",null,"\xc0 l'exception des contr\xf4leurs de domaine, toutes les machines Windows, qu'elles soient d'une \xe9dition client (Windows 10 / 11) ou serveur, poss\xe8dent des utilisateurs locaux. Comme vous l'avez vu dans le cours de syst\xe8mes d'exploitation, les utilisateurs locaux peuvent \xeatre g\xe9r\xe9s au moyen du composant enfichable \"Utilisateurs et groupes locaux\" dans une console MMC (accessible par lusrmgr.msc ou compmgmt.msc). Par d\xe9faut, lorsqu'on installe Windows, un certain nombre de comptes utilisateurs sont cr\xe9\xe9s, dont ",(0,r.kt)("em",{parentName:"p"},"Administrateur")," et ",(0,r.kt)("em",{parentName:"p"},"Invit\xe9"),"."),(0,r.kt)("p",null,"Windows poss\xe8de \xe9galement un ensemble de groupes locaux pr\xe9d\xe9finis. On peut ajouter des comptes (locaux ou domaine) dans un groupe local. Certains groupes poss\xe8dent des privil\xe8ges particuliers, comme le groupe ",(0,r.kt)("strong",{parentName:"p"},"Administrateurs"),"; tous les comptes utilisateurs membres de ce groupe disposent du ",(0,r.kt)("strong",{parentName:"p"},"privil\xe8ge d'\xe9l\xe9vation"),' ("ex\xe9cuter en tant qu\'admin"). Les membres du groupe ',(0,r.kt)("strong",{parentName:"p"},"Utilisateurs"),", quant \xe0 eux, disposent du privil\xe8ge de ",(0,r.kt)("strong",{parentName:"p"},"d\xe9marrage de session locale"),". "),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Un utilisateur qui n'est pas membre d'un de ces groupes ne sera pas autoris\xe9 \xe0 d\xe9marrer une session.")),(0,r.kt)("p",null,"On peut utiliser PowerShell pour contr\xf4ler les utilisateurs locaux, les groupes locaux ainsi que l'appartenance aux groupes locaux. PowerShell offre pour ce faire un module ",(0,r.kt)("inlineCode",{parentName:"p"},"Microsoft.PowerShell.LocalAccounts")," qui renferme plusieurs commandes, notamment:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Add-LocalGroupMember")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Disable-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Enable-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Get-LocalGroup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Get-LocalGroupMember")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Get-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"New-LocalGroup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"New-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Remove-LocalGroup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Remove-LocalGroupMember")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Remove-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Rename-LocalGroup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Rename-LocalUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Set-LocalGroup")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Set-LocalUser"))),(0,r.kt)("h3",{id:"consulter-les-utilisateurs-existants"},"Consulter les utilisateurs existants"),(0,r.kt)("p",null,"La commande Get-LocalUser permet d'obtenir la liste des utilisateurs locaux. Elle retourne un ou plusieurs objets de types ",(0,r.kt)("inlineCode",{parentName:"p"},"[Microsoft.PowerShell.Commands.LocalUser]")," qui d\xe9crivent un compte utilisateur local."),(0,r.kt)(m,{workdir:"C:\\",command:"Get-LocalUser",result:"\nName               Enabled Description \n----               ------- -----------\nAdministrateur     True    Compte d\u2019utilisateur d\u2019administration\nDefaultAccount     False   Compte utilisateur g\xe9r\xe9 par le syst\xe8me.\nInvit\xe9             False   Compte d\u2019utilisateur invit\xe9\npaul               True    Boss de la compagnie\nWDAGUtilityAccount False   Compte d\u2019utilisateur g\xe9r\xe9 et utilis\xe9 par le syst...",mdxType:"PowerShellWindow"}),(0,r.kt)("p",null,"Ces objets poss\xe8dent plusieurs informations sur le compte utilisateur. On peut les voir en explorant la structure de l'objet, par exemple avec ",(0,r.kt)("inlineCode",{parentName:"p"},"Select-Object *"),"."),(0,r.kt)(m,{workdir:"C:\\",command:"Get-LocalUser -Name 'paul' | Select-Object *",result:"\nAccountExpires         : 2023-05-12 20:06:27\nDescription            : Boss de la compagnie\nEnabled                : True\nFullName               : Paul Meilleur\nPasswordChangeableDate : 2023-04-13 20:06:27\nPasswordExpires        : 2023-05-24 20:06:27\nUserMayChangePassword  : True\nPasswordRequired       : False\nPasswordLastSet        : 2023-04-12 20:06:27\nLastLogon              :\nName                   : paul\nSID                    : S-1-5-21-3297567932-2200011671-69726474-1001\nPrincipalSource        : Local\nObjectClass            : Utilisateur",mdxType:"PowerShellWindow"}),(0,r.kt)("h3",{id:"cr\xe9ation-dun-nouvel-utilisateur"},"Cr\xe9ation d'un nouvel utilisateur"),(0,r.kt)("p",null,"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"New-LocalUser")," cr\xe9e un utilisateur local et retourne l'objet d\xe9crivant cet utilisateur dans le pipeline (comme il est d'usage par la majorit\xe9 des commandes exploitant le verbe ",(0,r.kt)("inlineCode",{parentName:"p"},"New-"),"). Il faut \xe9videmment que la session PowerShell soit \xe9lev\xe9e en tant qu'admin pour apporter des modifications sur les utilisateurs locaux."),(0,r.kt)("p",null,"La commande offre un certains nombres de param\xe8tres pour sp\xe9cifier les diff\xe9rentes propri\xe9t\xe9s du compte \xe0 cr\xe9er."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Param\xe8tre"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Name")),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Le nom d'utilisateur (",(0,r.kt)("em",{parentName:"td"},"login"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"FullName")),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Le nom complet (pr\xe9nom nom)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Description")),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Le champ Description")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AccountExpires")),(0,r.kt)("td",{parentName:"tr",align:null},"DateTime"),(0,r.kt)("td",{parentName:"tr",align:null},"La date d'expiration de l'utilisateur")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AccountNeverExpires")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Indique que le compte n'expire jamais")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Disabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Indique que le compte est d\xe9sactiv\xe9 d\xe8s sa cr\xe9ation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Password")),(0,r.kt)("td",{parentName:"tr",align:null},"SecureString"),(0,r.kt)("td",{parentName:"tr",align:null},"Le mot de passe de l'utilisateur")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"NoPassword")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Indique que le compte n'a aucun mot de passe (pas tr\xe8s s\xe9curitaire!)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PasswordNeverExpires")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Indique que le mot de passe n'expire jamais")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"UserMayNotChangePassword")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Indique que l'utilisateur n'a pas le droit de modifier son mot de passe")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"WhatIf")),(0,r.kt)("td",{parentName:"tr",align:null},"Switch"),(0,r.kt)("td",{parentName:"tr",align:null},"Fait en sorte que la commande ne cr\xe9e pas l'utilisateur pour vrai (utile pour tester)")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Le mot de passe est de type ",(0,r.kt)("inlineCode",{parentName:"p"},"[SecureString]")," et pas une cha\xeene de caract\xe8res normale. Ce qui fait qu'on doit d'abord convertir la cha\xeene de caract\xe8re en cha\xeene s\xe9curis\xe9e. On peut le faire au moyen de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"ConvertTo-SecureString"),"."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"$securepasswd = 'Passw0rd' | ConvertTo-SecureString -AsPlainText -Force\n"))),(0,r.kt)("p",null,"Voici un exemple de cr\xe9ation d'un compte utilisateur local (en utilisant le ",(0,r.kt)("em",{parentName:"p"},"splatting"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$NouvelUtilisateurSplat = @{\n    Name = "paul"\n    FullName = "Paul Meilleur"\n    Description = "Boss de la compagnie"\n    AccountExpires = (Get-Date).AddDays(30)   # Dans 30 jours\n    Password = ConvertTo-SecureString -String "Passw0rd" -AsPlainText -Force\n}\n\nNew-LocalUser @NouvelUtilisateurSplat\n')),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"On ne devrait jamais mettre des mots de passe en clair dans un script, ni stocker un mot de passe dans une variable en texte clair!!! Voici quelques options pour l'\xe9viter:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Cr\xe9er un algorithme qui choisit automatiquement un mot de passe en fonction d'information provenant de l'ext\xe9rieur"),(0,r.kt)("li",{parentName:"ul"},"Utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"li"},"Read-Host -AsSecureString")," pour demander \xe0 l'utilisateur d'entrer un mot de passe (dont la saisie est masqu\xe9e"),(0,r.kt)("li",{parentName:"ul"},"Utiliser ",(0,r.kt)("inlineCode",{parentName:"li"},"Get-Credential")," pour fournir un nom d'utilisateur et un mot de passe. Nous verrons plus loin cette commande lorsque nous traiterons de l'authentification par PowerShell."))),(0,r.kt)("h3",{id:"groupes-locaux"},"Groupes locaux"),(0,r.kt)("p",null,"\xc0 l'instar des utilisateurs, on peut conna\xeetre les groupes locaux au moyen de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-LocalGroup"),"."),(0,r.kt)("p",null,"Pour cr\xe9er un groupe local, on utilise la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"New-LocalGroup"),". L\xe0 encore, cette commande ne fonctionne que dans une session PowerShell \xe9lev\xe9e."),(0,r.kt)("p",null,"Pour obtenir les membres d'un groupe, on peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-LocalGroupMember"),"."),(0,r.kt)(m,{workdir:"C:\\",command:"Get-LocalGroupMember -Group 'Administrateurs'",result:"\nObjectClass Name                    PrincipalSource\n----------- ----                    ---------------\nUtilisateur PC0001\\Administrateur   Local\nUtilisateur PC0001\\bob              Local\nUtilisateur PC0001\\paul             Local\nUtilisateur PC0001\\pierre           Local\nGroupe      MINOU\\Admins du domaine ActiveDirectory\nUtilisateur MINOU\\paul.meilleur     ActiveDirectory",mdxType:"PowerShellWindow"}),(0,r.kt)("p",null,"Pour ajouter un utilisateur dans un groupe, on utilise la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Add-LocalGroupMember"),". Cette commande prend en param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Member")," qui d\xe9signe le membre \xe0 ajouter, ainsi que ",(0,r.kt)("inlineCode",{parentName:"p"},"-Group")," qui d\xe9signe le groupe dans lequel l'ajouter."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Add-LocalGroupMember \u2013Member "Paul" -Group "Administrateurs"\n')),(0,r.kt)("p",null,"Cette commande admet qu'on passe le membre \xe0 ajouter par le pipeline en entr\xe9e."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-LocalUser -Name "Paul" | Add-LocalGroupMember -Group "Administrateurs"\n')),(0,r.kt)("p",null,"Cela permet, entre autres, de cr\xe9er un compte et l'ajouter imm\xe9diatement \xe0 un groupe, puisque la cr\xe9ation g\xe9n\xe8re un objet repr\xe9sentant l'utilisateur."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'New-LocalUser -Name "Zoe" -NoPassword | Add-LocalGroupMember -Group "Utilisateurs"\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"On peut aussi ajouter des utilisateurs ou des groupes du domaine comme membre d'un groupe local. Pour ce faire, on n'a qu'\xe0 sp\xe9cifier le sAMAccountName du principal de s\xe9curit\xe9 du domaine. Si la machine dispose d'une relation d'approbation avec le domaine du compte, celui-ci sera ajout\xe9 comme membre au groupe."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Add-LocalGroupMember \u2013Member "DOMAINE\\paul.meilleur" -Group "Administrateurs"\n'))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Le nom des groupes est diff\xe9rent sur les versions anglaise et fran\xe7aise de Windows. Pour que le script fonctionne ind\xe9pendamment de la langue du syst\xe8me, on peut utiliser le SID du groupe plut\xf4t que son nom. Le SID est un num\xe9ro d'identification unique, et dans le cas des groupes pr\xe9d\xe9finis dans Windows (Administrateurs, Utilisateurs), il est toujours le m\xeame peu importe la langue."),(0,r.kt)("p",{parentName:"admonition"},"On peut voir les SID des groupes avec la commande suivante:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-LocalGroup | Select-Object -Property Name, SID\n")),(0,r.kt)("p",{parentName:"admonition"},"Voici quelques SID bien connus:"),(0,r.kt)("table",{parentName:"admonition"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nom fran\xe7ais"),(0,r.kt)("th",{parentName:"tr",align:null},"Nom anglais"),(0,r.kt)("th",{parentName:"tr",align:null},"SID"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administrateurs"),(0,r.kt)("td",{parentName:"tr",align:null},"Administrators"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"S-1-5-32-544"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateurs"),(0,r.kt)("td",{parentName:"tr",align:null},"Users"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"S-1-5-32 545"))))),(0,r.kt)("p",{parentName:"admonition"},"Par exemple, pour ajouter un utilisateur au groupe des administrateurs:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$MonUtilisateur | Add-LocalGroupMember -SID "S-1-5-32-544"\n'))),(0,r.kt)("h2",{id:"gestion-des-comptes-du-domaine"},"Gestion des comptes du domaine"),(0,r.kt)("h3",{id:"outils-rsat"},"Outils RSAT"),(0,r.kt)("p",null,"Lorsqu'on fait la promotion d'un serveur Windows en contr\xf4leur de domaine, les outils d'administration d'Active Directory s'installent automatiquement sur cette machine. Les outils d'administration AD font partie d'une collection de consoles MMC connue sous le nom de RSAT (Remote Server Administration Tools)."),(0,r.kt)("p",null,"Il existe plusieurs outils RSAT, qui sont normalement activ\xe9s lorsqu'on installe le r\xf4le ou la fonctionnalit\xe9 sur un serveur, afin d'\xeatre utilis\xe9s localement sur ce serveur. Ce sont des composants optionnels de Windows, qui sont pr\xeats \xe0 \xeatre install\xe9s lorsque n\xe9cessaire. Ainsi, la console RSAT DNS est install\xe9e automatiquement sur un serveur lorsqu'on active le r\xf4le DNS, et la console DHCP s'installe automatiquement sur un serveur DHCP, etc. On n'est pas oblig\xe9 d'installer toutes les consoles RSAT, seulement celles dont on a besoin."),(0,r.kt)("p",null,"Lorsqu'on installe un r\xf4le (par exemple, Active Directory Domain Services), les consoles pour AD s'installent automatiquement. Mais il arrive qu'on souhaite installer une console RSAT sur une machine pour l'administration \xe0 distance. On peut donc installer les consoles ind\xe9pendamment, ce qui nous permet d'utiliser ce serveur pour administrer un service h\xe9berg\xe9 sur un autre serveur."),(0,r.kt)("p",null,"Par exemple, il est rare que les administrateurs AD d\xe9marrent une session interactive RDP ou locale sur un contr\xf4leur de domaine pour y cr\xe9er des utilisateurs. Ce n'est pas une bonne pratique. G\xe9n\xe9ralement, les administrateurs vont op\xe9rer la console sur une autre machine, soit leur poste de travail ou sur un serveur tiers qu'on qualifie de \"jump station\"."),(0,r.kt)("p",null,"Les consoles qui font partie des outils RSAT pour Active Directory sont:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Active Directory Users and Computers (dsa.msc)"),(0,r.kt)("li",{parentName:"ul"},"Active Directory Sites and Services (dssite.msc)"),(0,r.kt)("li",{parentName:"ul"},"Active Directory Domains and Trusts (domain.msc)"),(0,r.kt)("li",{parentName:"ul"},"ADSIEdit (adsiedit.msc)"),(0,r.kt)("li",{parentName:"ul"},"Active Directory Administrative Center (dsac.exe)"),(0,r.kt)("li",{parentName:"ul"},"Group Policy Managament Tool (gpmc.msc)")),(0,r.kt)("p",null,"Lorsqu'on installe les outils RSAT pour Active Directory, un module PowerShell pour manipuler Active Directory s'installe \xe9galement. On peut utiliser ce module pour acc\xe9der \xe0 des commandes PowerShell utilisable dans nos scripts pour automatiser ce que nous ferions normalement \xe0 la main via les consoles MMC. Les outils RSAT install\xe9s sont expos\xe9s via l'\xe9l\xe9ment Administrative Tools du menu D\xe9marrer ou du vieux panneau de configuration de Windows (control.exe)."),(0,r.kt)("p",null,"Les proc\xe9dures et les commandes pour installer les outils RSAT ne sont pas les m\xeames pour les \xe9ditions client et serveur de Windows."),(0,r.kt)("h4",{id:"installer-rsat-sous-windows-server"},"Installer RSAT sous Windows Server"),(0,r.kt)("p",null,"Sur un serveur Windows, par d\xe9faut, lorsqu'on installe un r\xf4le ou une fonctionnalit\xe9, les outils RSAT correspondants s'installent aussi. Pour installer un outil RSAT sans installer le r\xf4le ou la fonctionnalit\xe9, on peut utiliser les commandes dont le nom est ",(0,r.kt)("em",{parentName:"p"},"WindowsFeature"),"."),(0,r.kt)("p",null,"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-WindowsFeature")," permet d'obtenir la liste des r\xf4les et fonctionnalit\xe9s (dans la m\xeame liste, contrairement \xe0 l'interface graphique). Chaque fonctionnalit\xe9 a son nom qui respecte une convention de nommage, et toutes les consoles d'administrations commencent par le pr\xe9fixe RSAT (\xe0 l'exception de la console de gestion des strat\xe9gies de groupe)."),(0,r.kt)("p",null,"Pour voir tous les outils d'administration disponibles, on peut lancer:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-WindowsFeature -Name "RSAT-*", "GPMC"\n')),(0,r.kt)("p",null,"Pour installer toutes les consoles de gestion pour Active Directory DS, y compris la console de gestion des strat\xe9gies de groupe (GPMC) et le module PowerShell, lancez la commande suivante:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Install-WindowsFeature -Name RSAT-AD-Tools, GPMC -IncludeAllSubFeature\n")),(0,r.kt)("h4",{id:"installer-rsat-sous-windows-1011"},"Installer RSAT sous Windows 10/11"),(0,r.kt)("p",null,'Sur un client Windows, les outils RSAT sont consid\xe9r\xe9s comme des composants optionnels, aussi appel\xe9s "Feature-on-Demand", qui peuvent \xeatre install\xe9s \xe0 la demande. Contrairement aux serveurs, les \xe9ditions clientes de Windows doivent t\xe9l\xe9charger les composants RSAT d\'Internet sur les serveurs de mises \xe0 jour de Microsoft.'),(0,r.kt)("p",null,'Pour g\xe9rer ces composants optionnels, on peut utiliser les commande PowerShell dont le nom est "WindowsCapability".'),(0,r.kt)("p",null,"Pour installer toutes les consoles de gestion pour Active Directory DS, y compris la console de gestion des strat\xe9gies de groupe (GPMC) et le module PowerShell, lancez la commande suivante:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-WindowsCapability -Online | Where-Object { $_.Name -Match "^rsat\\.activedirectory|grouppolicy.*$" } | Add-WindowsCapability -Online\n')),(0,r.kt)("h4",{id:"module-powershell-pour-adds"},"Module PowerShell pour ADDS"),(0,r.kt)("p",null,"Les outils RSAT pour administrer Active Directory comprennent un module PowerShell qui offre une panoplie de commandes pour contr\xf4ler AD."),(0,r.kt)("p",null,"Pour l'utiliser, il faut importer le module."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Import-Module ActiveDirectory\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Il n'est pas n\xe9cessaire d'ex\xe9cuter ces commandes \xe0 partir d'un contr\xf4leur de domaine. En fait, il est pr\xe9f\xe9rable de le faire \xe0 partir d'un autre ordinateur, pourvu qu'il soit membre du domaine. C'est le compte utilis\xe9 pour lancer les commandes qui importe, pas la machine sur laquelle elles sont lanc\xe9es.")),(0,r.kt)("p",null,"On peut ensuite lister toutes les commandes qui sont offertes par ce module."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-Command -Module ActiveDirectory\n")),(0,r.kt)("p",null,"On peut v\xe9rifier les modules install\xe9s qui sont disponibles pour \xeatre import\xe9s. Pour v\xe9rifier quels modules sont import\xe9s dans la session PowerShell en cours, on utilise la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-Module"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-Module -ListAvailable\n")),(0,r.kt)("p",null,"Pour charger le module Active Directory dans un script, on doit lancer la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Import-Module")," au d\xe9but du script (plus pr\xe9cis\xe9ment, avant de lancer toute commande de ce module)."),(0,r.kt)("p",null,"Il est aussi recommand\xe9 d'ajouter une instruction ",(0,r.kt)("inlineCode",{parentName:"p"},"#Requires"),", pour faire planter le script automatiquement avant m\xeame le d\xe9but de son ex\xe9cution si le module Active Directory n'est pas install\xe9. On \xe9vite ainsi des erreurs plus tard dans le script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"#Requires -Module ActiveDirectory\nImport-Module ActiveDirectory\n")),(0,r.kt)("p",null,"Plus de d\xe9tails sur l'instruction ",(0,r.kt)("inlineCode",{parentName:"p"},"#Requires")," ici: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_requires?view=powershell-5.1"},"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_requires?view=powershell-5.1")),(0,r.kt)("h3",{id:"informations-sur-le-domaine-et-la-for\xeat"},"Informations sur le domaine et la for\xeat"),(0,r.kt)("p",null,"Les commandes ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADDomain")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADForest")," permettent d'obtenir de l'information sur le domaine et la for\xeat respectivement, tels que le niveau fonctionnel, les contr\xf4leurs de domaine qui disposent d'un r\xf4le FSMO, les conteneurs par d\xe9faut, le SID du domaine, la topologie des sites, etc."),(0,r.kt)("p",null,(0,r.kt)("a",{target:"_blank",href:n(5973).Z},"Get-ADDomain")),(0,r.kt)("p",null,"Une information int\xe9ressante est celle du contexte de nom par d\xe9faut (",(0,r.kt)("em",{parentName:"p"},"Default Naming Context"),"). Il \xe9quivaut \xe0 la partie domaine \xe0 la fin des noms distinctifs des objets dans le domaine. On peut l'obtenir \xe0 l'aide de la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-RootDSE"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"(Get-ADRootDSE).defaultNamingContext\n")),(0,r.kt)("h3",{id:"unit\xe9s-dorganisation"},"Unit\xe9s d'organisation"),(0,r.kt)("p",null,"Les unit\xe9s d'organisation (",(0,r.kt)("em",{parentName:"p"},"Organizational Unit"),", ou ",(0,r.kt)("em",{parentName:"p"},"OU"),") sont des conteneurs dans lesquels on peut disposer des objets du domaine et sur lesquels on peut lier des strat\xe9gies de groupe (GPO). Ce ne sont pas tous les conteneurs qui sont des unit\xe9s d'organisation; ces derni\xe8res portent le pr\xe9fixe ",(0,r.kt)("inlineCode",{parentName:"p"},"OU=")," dans leur nom distinctif relatif."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Unit\xe9s d&#39;organisation",src:n(4161).Z,width:"343",height:"330"})),(0,r.kt)("h4",{id:"recherche-dune-unit\xe9-dorganisation"},"Recherche d'une unit\xe9 d'organisation"),(0,r.kt)("p",null,"Pour obtenir de l'information sur une unit\xe9 d'organisation sp\xe9cifique, on peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADOrganizationalUnit")," en lui fournissant le nom distinctif (DN) de l'unit\xe9 d'organisation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADOrganizationalUnit -Identity "OU=Laptops,DC=ad,DC=mondomaine,DC=com"\n')),(0,r.kt)("p",null,"On peut obtenir la liste de toutes les unit\xe9s d'organisation du domaine en sp\xe9cifiant le filtre *"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-ADOrganizationalUnit -Filter * | Format-Table\n")),(0,r.kt)("h4",{id:"cr\xe9ation-dune-unit\xe9-dorganisation"},"Cr\xe9ation d'une unit\xe9 d'organisation"),(0,r.kt)("p",null,"Pour cr\xe9er une unit\xe9 d'organisation dans un domaine, on utilise la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"New-ADOrganizationalUnit")," en lui sp\xe9cifiant le nom de l'OU \xe0 cr\xe9er ainsi que le nom distinctif complet du conteneur parent."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$ADOrganizationalUnitSplat = @{\n    Name = "Laptops"\n    Path = "OU=Laptops,DC=ad,DC=mondomaine,DC=com"\n}\n\nNew-ADOrganizationalUnit @ADOrganizationalUnitSplat\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"La commande ",(0,r.kt)("inlineCode",{parentName:"p"},"New-ADOrganizationalUnit")," ne retourne pas d'objet par d\xe9faut dans le pipeline. Pour qu'elle en retourne un, on n'a qu'\xe0 lui passer le switch ",(0,r.kt)("inlineCode",{parentName:"p"},"-PassThru"),"."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"New-ADOrganizationalUnit @ADOrganizationalUnitSplat -PassThru\n"))),(0,r.kt)("h3",{id:"comptes-utilisateurs"},"Comptes utilisateurs"),(0,r.kt)("h4",{id:"recherche-dun-compte-utilisateur"},"Recherche d'un compte utilisateur"),(0,r.kt)("p",null,"Pour rechercher un utilisateur dans Active Directory, la commande \xe0 utiliser est ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADUser"),"."),(0,r.kt)("p",null,"Pour rechercher un utilisateur sp\xe9cifique, on peut sp\xe9cifier le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Identity"),". Ce param\xe8tre peut admettre comme valeur le nom d'utilisateur court (sAMAccountName), le nom distinctif (DN), le SID ou le GUID."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADUser -Identity "zzappa"\n')),(0,r.kt)("p",null,"Pour rechercher les utilisateurs ob\xe9issant \xe0 certains crit\xe8res, on peut utiliser le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Filter"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-ADUser -Filter 'sAMAccountName -like \"z*\"'\n")),(0,r.kt)("h4",{id:"v\xe9rification-de-lexistence-dun-compte-utilisateur"},"V\xe9rification de l'existence d'un compte utilisateur"),(0,r.kt)("p",null,"Pour tester l'existence d'un utilisateur dans le domaine, voici un exemple:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'if (Get-ADUser -Filter \'sAMAccountName -eq "zzappa"\') {\n    Write-Host "L\'utilisateur existe."\n}\nelse {\n    Write-Host "L\'utilisateur n\'existe pas."\n}\n')),(0,r.kt)("h4",{id:"cr\xe9ation-dun-nouveau-compte-utilisateur"},"Cr\xe9ation d'un nouveau compte utilisateur"),(0,r.kt)("p",null,"Pour cr\xe9er un nouvel utilisateur, on peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"New-ADUser"),". \xc9tant donn\xe9 la quantit\xe9 d'attributs disponibles dans les objets utilisateurs, cette commande admet un tr\xe8s grand nombre d'arguments. Voici un exemple de cr\xe9ation d'un compte utilisateur (la plupart de ces attributs sont facultatifs; en fait, seul le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"Name")," est obligatoire)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$ADUserSplat = @{\n    Path = "OU=Utilisateurs,DC=ad,DC=mondomaine,DC=com"\n    Name = "Zoe Zappa"\n    GivenName = "Zo\xe9"\n    Surname = "Zappa"\n    Initials = "Z."\n    Title = "Dr."\n    DisplayName = "Dr. Zo\xe9 Zappa, Ph.D."\n    Description = "VP de ch\xe9poquoi"\n    SamAccountName = "zzappa"\n    UserPrincipalName = "zzappa@ad.mondomaine.com"\n    AccountPassword = "Passw0rd" | ConvertTo-SecureString -AsPlainText -Force\n    ChangePasswordAtLogon = $true\n    StreetAddress = "42 rue des timinous"\n    City = "Minoupolis"\n    Country = "CA"\n    PostalCode = "H0H 0H0"\n    MobilePhone = "(555) 555-5555"\n    EmployeeNumber = "2546011"\n    EmailAddress = "zzappa@mondomaine.com"\n    Enabled = $true\n}\n\nNew-ADUser @ADUserSplat\n')),(0,r.kt)("p",null,"Vous pouvez consulter la liste des param\xe8tres de cette commande sur ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/fr-ca/powershell/module/activedirectory/new-aduser"},"sa page de documentation"),"."),(0,r.kt)("h4",{id:"modification-dun-compte-utilisateur-existant"},"Modification d'un compte utilisateur existant"),(0,r.kt)("p",null,"On peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Set-ADUser")," pour modifier un attribut d'un compte utilisateur existant. L'exemple suivant modifie l'adresse courriel de l'utilisateur Bob."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$ADSetUserSplat = @{\n    Identity = "Bob"\n    EmailAddress = "bob@mondomaine.com"\n}\n\nSet-ADUser @ADSetUserSplat\n')),(0,r.kt)("h4",{id:"suppression-dun-compte-utilisateur"},"Suppression d'un compte utilisateur"),(0,r.kt)("p",null,"On peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Remove-ADUser")," pour supprimer un compte utilisateur. Voici un exemple en lui passant un compte utilisateur par le pipeline."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADUser -Identity "zzappa" | Remove-ADUser\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Dans son comportement par d\xe9faut, ",(0,r.kt)("inlineCode",{parentName:"p"},"Remove-ADUser")," demande une confirmation. Pour rendre l'op\xe9ration compl\xe8tement automatique, on peut d\xe9sactiver le switch ",(0,r.kt)("inlineCode",{parentName:"p"},"-Confirm"),", qui est activ\xe9 par d\xe9faut (\xe9trangement)."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Remove-ADUser -Identity "zzappa" -Confirm:$false\n'))),(0,r.kt)("h3",{id:"groupes"},"Groupes"),(0,r.kt)("h4",{id:"recherche-dun-groupe"},"Recherche d'un groupe"),(0,r.kt)("p",null,"Pour obtenir de l'information sur un groupe, on peut utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADGroup"),". Cette commande s'emploie de la m\xeame mani\xe8re que pour les utilisateurs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADGroup -Identity "Comptables"\n')),(0,r.kt)("p",null,"Le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Identity")," peut admettre le nom du compte (",(0,r.kt)("em",{parentName:"p"},"sAMAccountName"),") mais aussi son ",(0,r.kt)("em",{parentName:"p"},"SID"),", son ",(0,r.kt)("em",{parentName:"p"},"GUID")," ou son nom distinctif (",(0,r.kt)("em",{parentName:"p"},"DN"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADGroup -Identity "CN=Comptables,OU=Groupes,DC=ad,DC=mondomaine,DC=com"\n')),(0,r.kt)("h4",{id:"v\xe9rification-de-lexistence-dun-groupe"},"V\xe9rification de l'existence d'un groupe"),(0,r.kt)("p",null,"Pour v\xe9rifier si un groupe existe, on peut employer la m\xeame logique que pour les utilisateurs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'if (Get-ADGroup -Filter \'sAMAccountName -eq "Comptables"\') {\n    Write-Host "L\'utilisateur existe."\n}\nelse {\n    Write-Host "L\'utilisateur n\'existe pas."\n}\n')),(0,r.kt)("h4",{id:"cr\xe9ation-dun-nouveau-groupe"},"Cr\xe9ation d'un nouveau groupe"),(0,r.kt)("p",null,"Pour cr\xe9er un nouveau groupe, voici un exemple. Il faut minimalement sp\xe9cifier son nom, sa port\xe9e (global, domaine local ou universel) ainsi que le nom distinctif complet du conteneur dans lequel le cr\xe9er."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$ADGroupSplat = @{\n    Name = "Gestionnaires"\n    GroupScope = "Global"\n    Path = "OU=Groupes,DC=ad,DC=mondomaine,DC=com"\n}\n\nNew-ADGroup @ADGroupSplat\n')),(0,r.kt)("h3",{id:"membres-de-groupes"},"Membres de groupes"),(0,r.kt)("p",null,"Un groupe poss\xe8de des membres, qui peuvent \xeatre soit des utilisateurs, des ordinateurs ou d'autres groupes. On nomme ces objets des ",(0,r.kt)("em",{parentName:"p"},"principaux de s\xe9curit\xe9"),". "),(0,r.kt)("h4",{id:"obtention-des-membres-dun-groupe"},"Obtention des membres d'un groupe"),(0,r.kt)("p",null,"Pour consulter quels principaux de s\xe9curit\xe9 sont membres d'un groupe sp\xe9cifique, voici un exemple:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADGroupMember -Identity "Comptables"\n')),(0,r.kt)("p",null,"On peut aussi passer un groupe par le pipeline."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADGroup -Identity "Comptables" | Get-ADGroupMember\n')),(0,r.kt)("h4",{id:"ajout-de-membres-\xe0-un-groupe"},"Ajout de membres \xe0 un groupe"),(0,r.kt)("p",null,"Pour ajouter un utilisateur \xe0 un groupe, voici un exemple:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Add-ADGroupMember -Identity "Admins du domaine" -Members "zzappa"\n')),(0,r.kt)("p",null,"On peut \xe9galement ajouter un autre type de principal de s\xe9curit\xe9, comme un compte ordinateur ou un groupe. Le proc\xe9d\xe9 est alors exactement le m\xeame; il suffit de donner le nom du groupe ou de l'ordinateur dans l'argument ",(0,r.kt)("inlineCode",{parentName:"p"},"-Members"),". Par ailleurs, puisque le param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Members")," admet un tableau, il est possible de lui passer un tableaux de membres, qui seront tous ajout\xe9s d'un coup au groupe."),(0,r.kt)("h4",{id:"retrait-de-membres-\xe0-un-groupe"},"Retrait de membres \xe0 un groupe"),(0,r.kt)("p",null,"Pour retirer un compte d'un groupe, il suffit d'utiliser cette commande:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Remove-ADGroupMember -Identity "Admins du domaine" -Members "zzappa"\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Pour \xe9viter de d\xe9pendre de la langue du syst\xe8me et de la traduction de ses noms de groupes, on peut utiliser le SID des groupes bien connus, comme le groupe des admins du domaine."),(0,r.kt)("p",{parentName:"admonition"},"Le SID du groupe des admins du domaine est constitu\xe9 du SID du domaine suivi du RID 512. Ainsi, voici comment on peut le trouver dynamiquement."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$DomainSID = (Get-ADDomain).DomainSID.Value\n$DomainAdminSID = "$DomainSID-512"\nAdd-ADGroupMember -Identity $DomainAdminSID -Members "zzappa"\n'))),(0,r.kt)("h3",{id:"attributs"},"Attributs"),(0,r.kt)("p",null,"Lorsqu'on utilise des commandes ",(0,r.kt)("em",{parentName:"p"},"Get")," comme ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADUser")," ou ",(0,r.kt)("inlineCode",{parentName:"p"},"Get-ADComputer"),", ce ne sont pas tous les attributs des objets qui sont interrog\xe9s, et ce, m\xeame si on le passe dans un ",(0,r.kt)("inlineCode",{parentName:"p"},"Select-Object *"),". Pour interroger un attribut qui ne l'est pas par d\xe9faut, il faut le sp\xe9cifier au moyen du param\xe8tre ",(0,r.kt)("inlineCode",{parentName:"p"},"-Properties"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'Get-ADUser -Identity "zzappa" -Properties *\n')),(0,r.kt)("p",null,"Par exemple, pour obtenir la date de cr\xe9ation, on peut ajouter la propri\xe9t\xe9 ",(0,r.kt)("inlineCode",{parentName:"p"},"Created"),", qui n'est pas incluse dans l'objet par d\xe9faut."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Get-ADUser -Identity &quot;zzappa&quot; -Properties Created",src:n(6396).Z,width:"778",height:"312"})),(0,r.kt)("h3",{id:"outils-suppl\xe9mentaires"},"Outils suppl\xe9mentaires"),(0,r.kt)("p",null,"Pour parcourir graphiquement les attributs des objets, on peut utiliser divers outils."),(0,r.kt)("h4",{id:"fonctionnalit\xe9s-avanc\xe9es-de-la-console-aduc"},"Fonctionnalit\xe9s avanc\xe9es de la console ADUC"),(0,r.kt)("p",null,"Tout d'abord, la console Utilisateurs et ordinateurs Active Directory (",(0,r.kt)("em",{parentName:"p"},"dsa.msc"),") offre un onglet ",(0,r.kt)("strong",{parentName:"p"},"\xc9diteur d'attributs"),". Il n'est pas visible par d\xe9faut; il faut d'abord activer les ",(0,r.kt)("strong",{parentName:"p"},"fonctionnalit\xe9s avanc\xe9es")," de la console via le menu ",(0,r.kt)("strong",{parentName:"p"},"Affichage"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ADUC Fonctionnalit\xe9s avanc\xe9es",src:n(2685).Z,width:"631",height:"339"})," "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ADUC \xc9diteur d&#39;attributs",src:n(509).Z,width:"503",height:"295"})),(0,r.kt)("h4",{id:"adsi-edit"},"ADSI Edit"),(0,r.kt)("p",null,"Il existe \xe9galement un autre outil provenant des outils RSAT: l'outil de modification ADSI (adsiedit.msc). Il permet de parcourir la base de donn\xe9es LDAP du domaine et permet un meilleur contr\xf4le du domaine, \xe0 plus bas niveau. "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ADSI Edit",src:n(2640).Z,width:"528",height:"436"})),(0,r.kt)("h4",{id:"adexplorer-sysinternals"},"ADExplorer (Sysinternals)"),(0,r.kt)("p",null,"Finalement, l'outil ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/fr-ca/sysinternals/downloads/adexplorer"},"ADExplorer"),", provenant de la suite ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/fr-ca/sysinternals"},"SysInternals")," de Microsoft, permet de parcourir le domaine \xe0 tr\xe8s bas niveau, tout comme ADSIEdit, mais ne n\xe9cessite pas l'installation des outils RSAT. Il permet une navigation plus fluide que ADSIEdit, en montrant l'arborescence LDAP dans le panneau de gauche et les attributs de l'objet s\xe9lectionn\xe9 dans le panneau de droite. Cet outil n'est pas inclus dans Windows, il faut le ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/fr-ca/sysinternals/downloads/adexplorer"},"t\xe9l\xe9charger \xe0 partir du site Web de Microsoft"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ADSI Edit",src:n(6857).Z,width:"643",height:"480"})),(0,r.kt)("h4",{id:"module-adsips"},"Module AdsiPS"),(0,r.kt)("p",null,"Le module Active Directory de Windows est tr\xe8s pratique mais pr\xe9sente deux inconv\xe9nients:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Il n\xe9cessite l'installation des outils RSAT (donc des droits admin locaux et un acc\xe8s \xe0 Microsoft Update)"),(0,r.kt)("li",{parentName:"ul"},"Ses commandes n'emploient pas le protocole LDAP standard (port 389/tcp) mais plut\xf4t ADWS (port 9389/tcp)")),(0,r.kt)("p",null,"Mon coll\xe8gue Fran\xe7ois-Xavier Cat a d\xe9velopp\xe9 un module PowerShell qui se veut une alternative au module Active Directory. Il ne n\xe9cessite pas d'installation de RSAT et passe par le protocole LDAP."),(0,r.kt)("p",null,"Voici le lien vers son module: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lazywinadmin/AdsiPS"},"https://github.com/lazywinadmin/AdsiPS")," "),(0,r.kt)("p",null,"La mani\xe8re la plus simple d'installer le module est avec la commande Install-Module"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Install-Module -Name AdsiPS\n")),(0,r.kt)("p",null,"Si vous ne disposez pas de droits d'administration sur votre machine, vous pouvez alors le faire seulement pour votre profil utilisateur"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"Install-Module -Name AdsiPS -Scope CurrentUser\n")),(0,r.kt)("p",null,"Consultez cette page pour conna\xeetre la syntaxe des commandes de ce module: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/lazywinadmin/AdsiPS/blob/master/docs/doc_functions.md"},"https://github.com/lazywinadmin/AdsiPS/blob/master/docs/doc_functions.md")," "),(0,r.kt)("h2",{id:"extra-sid-rid-et-principaux-de-s\xe9curit\xe9"},"EXTRA: SID, RID et principaux de s\xe9curit\xe9"),(0,r.kt)("p",null,"Dans les services de domaine Active Directory, certains objets ont la propri\xe9t\xe9 de pouvoir se faire attribuer des droits \xe0 des ressources. Ce sont ces types d'objets qui peuvent, par exemple, \xeatre ajout\xe9s \xe0 une liste de contr\xf4le d'acc\xe8s (ACL). Ces objets se nomment les principaux de s\xe9curit\xe9. "),(0,r.kt)("p",null,"Active Directory compte quatre types de principaux de s\xe9curit\xe9: les comptes utilisateurs, les comptes d'ordinateurs, les groupes, ainsi que les comptes de service g\xe9r\xe9s, plus rarement utilis\xe9s. Ces objets poss\xe8dent un num\xe9ro unique de s\xe9curit\xe9, le SID, et c'est ce num\xe9ro qui est r\xe9f\xe9renc\xe9 dans les listes de permissions."),(0,r.kt)("h3",{id:"principaux-de-s\xe9curit\xe9-active-directory"},"Principaux de s\xe9curit\xe9 Active Directory"),(0,r.kt)("p",null,"Certains utilisateurs et groupes dans un domaine Active Directory sont cr\xe9\xe9s automatiquement d\xe8s la cr\xe9ation du domaine. Leur nom peut varier d'un domaine \xe0 l'autre, en fonction de la langue du premier contr\xf4leur de domaine ayant \xe9t\xe9 promu. Dans un domaine en anglais, le groupe des admins du domaine se nomme \"Domain Admins\", alors que dans un domaine en fran\xe7ais, il se nomme \"Admins du domaine\". M\xeame chose pour le compte Administrateur, qui se nomme Administrateur en fran\xe7ais, et qu'il est m\xeame possible de renommer au moyen d'une GPO. Cela peut compliquer le d\xe9veloppement de scripts, qu'on a avantage \xe0 rendre le plus g\xe9n\xe9ral possible."),(0,r.kt)("p",null,"\xc0 titre d'exemple, voici le SID du groupe des admins du domaine sur un domaine donn\xe9. Il est compos\xe9 de l'identifiant du domaine, auquel on greffe un identifiant relatif, le RID, \xe0 la fin de celui-ci. Le contr\xf4leur de domaine qui d\xe9tient le r\xf4le FSMO de RID Master est responsable de la gestion de ces RID, afin de s'assurer qu'ils sont uniques dans tout le domaine."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"SID et RID",src:n(9671).Z,width:"434",height:"63"})),(0,r.kt)("p",null,"Les principaux de domaine, quant \xe0 eux, sont relatifs au domaine, mais leur RID est toujours le m\xeame d'un domaine \xe0 l'autre. Le groupe des admins du domaine poss\xe8de le RID 512, donc leur SID est \xe9quivalent au SID du domaine, suivi de \"-512\". On peut donc obtenir le SID de tout principal de domaine simplement en connaissant son RID ainsi que le SID du domaine, qui peut \xeatre obtenu par la commande Get-ADDomain. Les identifiants sont document\xe9s sur le site de Microsoft."),(0,r.kt)("p",null,"En voici quelques exemples:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nom"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"RID (d\xe9cimal)"),(0,r.kt)("th",{parentName:"tr",align:null},"RID (hexad\xe9cimal)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administrateur"),(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateur"),(0,r.kt)("td",{parentName:"tr",align:null},"500"),(0,r.kt)("td",{parentName:"tr",align:null},"0x000001F4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Admins du domaine"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe global"),(0,r.kt)("td",{parentName:"tr",align:null},"512"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000200")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateurs du domaine"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe global"),(0,r.kt)("td",{parentName:"tr",align:null},"513"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000201")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Ordinateurs du domaine"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe global"),(0,r.kt)("td",{parentName:"tr",align:null},"515"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000203")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Contr\xf4leurs de domaine"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe global"),(0,r.kt)("td",{parentName:"tr",align:null},"516"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000204")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administrateurs du sch\xe9ma"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe universel"),(0,r.kt)("td",{parentName:"tr",align:null},"518"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000206")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administrateurs de l'entreprise"),(0,r.kt)("td",{parentName:"tr",align:null},"Groupe universel"),(0,r.kt)("td",{parentName:"tr",align:null},"519"),(0,r.kt)("td",{parentName:"tr",align:null},"0x00000207")))),(0,r.kt)("p",null,"Il est pr\xe9f\xe9rable d'utiliser le SID d'un de ces principaux, plut\xf4t que son nom, car ainsi, le script peut fonctionner ind\xe9pendamment de la langue. Il suffit de r\xe9unir le SID du domaine et le RID du principal pour obtenir son SID."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$DOMAIN_GROUP_RID_ADMINS = 512\n$DomainSID = (Get-ADDomain).DomainSid.Value\n$DomainAdminSID = "$DomainSID-$DOMAIN_GROUP_RID_ADMINS"\nGet-ADGroup -Identity $DomainAdminSID\n')),(0,r.kt)("h3",{id:"groupes-de-s\xe9curit\xe9-locaux"},"Groupes de s\xe9curit\xe9 locaux"),(0,r.kt)("p",null,'Windows dispose de groupes cr\xe9\xe9s automatiquement d\xe8s son installation, ainsi que des principaux sp\xe9ciaux, comme les "utilisateurs authentifi\xe9s" ou le groupe "tout le monde". Ces principaux ont toujours le m\xeame SID peu importe la machine et peu importe la langue. Les principaux locaux poss\xe8dent toujours le m\xeame SID. '),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nom"),(0,r.kt)("th",{parentName:"tr",align:null},"SID"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Administrateurs"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-32-544")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateurs"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-32-545")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateurs du bureau \xe0 distance"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-32-555")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Invit\xe9s"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-32-546")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Utilisateurs authentifi\xe9s"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-11")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SYST\xc8ME"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-5-18")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Tout le monde"),(0,r.kt)("td",{parentName:"tr",align:null},"S-1-1-0")))),(0,r.kt)("p",null,"R\xe9f\xe9rence: ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers"},"Security identifiers (Windows 10) - Windows security | Microsoft Docs")))}N.isMDXComponent=!0},5973:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/get-addomain-d02e125e71d85250b8715dd59bdfb2ef.png"},4161:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ad-ou-03ce79587dea7cb195b3e545ee00049e.png"},6857:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/adexplorer-64a0d9b0ddd918da28b0b21ae29029cc.png"},2640:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/adsiedit-attributeeditor-d8b389317cb443f92ea177b96dcad684.png"},2685:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aduc-advanced-342cb28ee1d33820baec6506efbc8e57.png"},509:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aduc-attributeeditor-c3a36542280c8f846dcbfd4959642e5f.png"},6396:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aduser-properties-d93f1f6f89d0f2c4530ee21fce5769c3.png"},9671:(e,t,n)=>{n.d(t,{Z:()=>a});const a="data:image/png;base64,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"}}]);