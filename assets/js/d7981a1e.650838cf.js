"use strict";(self.webpackChunkdepinfo_template=self.webpackChunkdepinfo_template||[]).push([[901],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=s,h=p["".concat(o,".").concat(m)]||p[m]||d[m]||i;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function h(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:s,r[1]=l;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),s=n(86010);const i={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,s.Z)(i.tabItem,r),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(87462),s=n(67294),i=n(86010),r=n(12466),l=n(16550),o=n(91980),u=n(67392),c=n(50012);function p(e){return function(e){return s.Children.map(e,(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:s}}=e;return{value:t,label:n,attributes:a,default:s}}))}function d(e){const{values:t,children:n}=e;return(0,s.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o._X)(i),(0,s.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(a.location.search);t.set(i,e),a.replace({...a.location,search:t.toString()})}),[i,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,i=d(e),[r,l]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:i}))),[o,u]=h({queryString:n,groupId:a}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,i]=(0,c.Nk)(n);return[a,(0,s.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:a}),k=(()=>{const e=o??p;return m({value:e,tabValues:i})?e:null})();(0,s.useLayoutEffect)((()=>{k&&l(k)}),[k]);return{selectedValue:r,selectValue:(0,s.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),f(e)}),[u,f,i]),tabValues:i}}var k=n(72389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:n,selectedValue:l,selectValue:o,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,r.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==l&&(p(t),o(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:r}=e;return s.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},r,{className:(0,i.Z)("tabs__item",g.tabItem,r?.className,{"tabs__item--active":l===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return s.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function N(e){const t=f(e);return s.createElement("div",{className:(0,i.Z)("tabs-container",g.tabList)},s.createElement(v,(0,a.Z)({},e,t)),s.createElement(b,(0,a.Z)({},e,t)))}function w(e){const t=(0,k.Z)();return s.createElement(N,(0,a.Z)({key:String(t)},e))}},55479:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>u,toc:()=>p});var a=n(87462),s=(n(67294),n(3905)),i=n(74866),r=n(85162);const l={title:"R10 - WinRM et planification",slug:"10",draft:!1},o="Rencontre 10 - WinRM et planification",u={unversionedId:"cours/r10",id:"cours/r10",title:"R10 - WinRM et planification",description:"- Protocoles de communication pour l'administration \xe0 distance",source:"@site/docs/cours/r10.md",sourceDirName:"cours",slug:"/cours/10",permalink:"/b64-scriptage-sous-windows/cours/10",draft:!1,tags:[],version:"current",lastUpdatedAt:1699997925,formattedLastUpdatedAt:"14 nov. 2023",frontMatter:{title:"R10 - WinRM et planification",slug:"10",draft:!1},sidebar:"docs",previous:{title:"R09 - Requ\xeates WMI",permalink:"/b64-scriptage-sous-windows/cours/09"},next:{title:"R11 - Travail pratique 2",permalink:"/b64-scriptage-sous-windows/cours/11"}},c={},p=[{value:"WMI \xe0 distance",id:"wmi-\xe0-distance",level:2},{value:"Pr\xe9paration",id:"pr\xe9paration",level:3},{value:"Pare-feu",id:"pare-feu",level:4},{value:"Get-Credential",id:"get-credential",level:3},{value:"Objets PSCredential",id:"objets-pscredential",level:3},{value:"RPC et WinRM",id:"rpc-et-winrm",level:3},{value:"Activation de WinRM sur un serveur",id:"activation-de-winrm-sur-un-serveur",level:3},{value:"Le pare-feu",id:"le-pare-feu",level:4},{value:"Chiffrement",id:"chiffrement",level:4},{value:"Sessions PowerShell \xe0 distance",id:"sessions-powershell-\xe0-distance",level:2},{value:"Authentification",id:"authentification",level:3},{value:"Cr\xe9er des sessions PowerShell",id:"cr\xe9er-des-sessions-powershell",level:3},{value:"Cr\xe9er la session",id:"cr\xe9er-la-session",level:4},{value:"Obtenir les sessions existantes",id:"obtenir-les-sessions-existantes",level:4},{value:"Affecter une session \xe0 une variable",id:"affecter-une-session-\xe0-une-variable",level:4},{value:"Terminer une session",id:"terminer-une-session",level:4},{value:"Terminer toutes les sessions ouvertes",id:"terminer-toutes-les-sessions-ouvertes",level:4},{value:"Invoke-Command",id:"invoke-command",level:3},{value:"Ex\xe9cuter un bloc de commandes",id:"ex\xe9cuter-un-bloc-de-commandes",level:4},{value:"Ex\xe9cuter un script",id:"ex\xe9cuter-un-script",level:4},{value:"Sp\xe9cifier les noms de machines au lieu des sessions",id:"sp\xe9cifier-les-noms-de-machines-au-lieu-des-sessions",level:4},{value:"PSRemoting et pipeline",id:"psremoting-et-pipeline",level:3},{value:"Plusieurs sessions en m\xeame temps",id:"plusieurs-sessions-en-m\xeame-temps",level:3},{value:"Copie de fichiers \xe0 travers une session",id:"copie-de-fichiers-\xe0-travers-une-session",level:3},{value:"De la machine locale vers la machine distante",id:"de-la-machine-locale-vers-la-machine-distante",level:4},{value:"De la machine distante vers la machine locale",id:"de-la-machine-distante-vers-la-machine-locale",level:4},{value:"Le planificateur de t\xe2ches",id:"le-planificateur-de-t\xe2ches",level:2},{value:"Composition d&#39;une t\xe2che planifi\xe9e",id:"composition-dune-t\xe2che-planifi\xe9e",level:3},{value:"D\xe9clencheur (<em>Trigger</em>)",id:"d\xe9clencheur-trigger",level:3},{value:"Action (<em>Action</em>)",id:"action-action",level:3},{value:"Conditions et param\xe8tres",id:"conditions-et-param\xe8tres",level:3},{value:"Forcer le lancement une t\xe2che planifi\xe9e",id:"forcer-le-lancement-une-t\xe2che-planifi\xe9e",level:3},{value:"Gestion des t\xe2ches planifi\xe9es en PowerShell",id:"gestion-des-t\xe2ches-planifi\xe9es-en-powershell",level:2},{value:"D\xe9finir le d\xe9clencheur",id:"d\xe9finir-le-d\xe9clencheur",level:3},{value:"D\xe9finir l&#39;action",id:"d\xe9finir-laction",level:3},{value:"D\xe9finir le principal",id:"d\xe9finir-le-principal",level:3},{value:"Enregistrer la t\xe2che planifi\xe9e",id:"enregistrer-la-t\xe2che-planifi\xe9e",level:3}],d={toc:p},m="wrapper";function h(e){let{components:t,...l}=e;return(0,s.kt)(m,(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"rencontre-10---winrm-et-planification"},"Rencontre 10 - WinRM et planification"),(0,s.kt)("admonition",{title:"R\xe9sum\xe9 de la s\xe9ance du vendredi 24 novembre 2023",type:"note"},(0,s.kt)(i.Z,{mdxType:"Tabs"},(0,s.kt)(r.Z,{value:"deroulement",label:"\ud83d\udc68\u200d\ud83c\udfeb D\xe9roulement du cours",mdxType:"TabItem"},(0,s.kt)("ul",{parentName:"admonition"},(0,s.kt)("li",{parentName:"ul"},"Protocoles de communication pour l'administration \xe0 distance",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"MSRPC / DCOM"),(0,s.kt)("li",{parentName:"ul"},"WinRM / WS-Management"))),(0,s.kt)("li",{parentName:"ul"},"Sessions PowerShell \xe0 distance (PSRemoting et WinRM)",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Interactif par la console (Enter-PSSession, Exit-PSSession...)"),(0,s.kt)("li",{parentName:"ul"},"Dans un script (New-PSSession, Invoke-Command...)"))),(0,s.kt)("li",{parentName:"ul"},"Planification de t\xe2ches",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Par l'interface graphique"),(0,s.kt)("li",{parentName:"ul"},"Au moyen de commandes PowerShell"),(0,s.kt)("li",{parentName:"ul"},"\xc0 distance via WinRM"))))),(0,s.kt)(r.Z,{value:"exercices",label:"\ud83d\udcbb Exercices \xe0 compl\xe9ter",mdxType:"TabItem"},(0,s.kt)("p",{parentName:"admonition"},"Faites la partie 2 du ",(0,s.kt)("a",{parentName:"p",href:"/b64-scriptage-sous-windows/tp/tp2#partie-2-script-de-d%C3%A9ploiement"},"TP2"),".")),(0,s.kt)(r.Z,{value:"ressources",label:"\ud83d\udcda Ressources \xe0 consulter",mdxType:"TabItem"},(0,s.kt)("p",{parentName:"admonition"},"La pr\xe9sentation PowerPoint est sur le Teams du cours, sous le canal G\xe9n\xe9ral > Fichiers > Supports de cours.")))),(0,s.kt)("h2",{id:"wmi-\xe0-distance"},"WMI \xe0 distance"),(0,s.kt)("p",null,"On peut lancer des requ\xeates WMI \xe0 distance sur une machine du r\xe9seau, en sp\xe9cifiant le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-ComputerName")," de la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-WmiObject"),"."),(0,s.kt)("p",null,"Pour que ce soit possible, il faut s'assurer de plusieurs choses:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"La machine distante est joignable sur le r\xe9seau"),(0,s.kt)("li",{parentName:"ul"},"Le service WMI (winmgmt) est actif sur la machine distante (c'est le cas par d\xe9faut)"),(0,s.kt)("li",{parentName:"ul"},"Nous avons des droits d'administration sur la machine distante"),(0,s.kt)("li",{parentName:"ul"},"Le pare-feu laisse passer le trafic WMI")),(0,s.kt)("p",null,"Lorsque les machines sont membres du domaine et que nous sommes authentifi\xe9s avec un compte qui poss\xe8de des droits d'administration sur les machines (c'est le cas du compte d'admin du domaine), il suffit de pr\xe9ciser le nom de la machine et les requ\xeates se font \xe0 travers le r\xe9seau."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(83161).Z,width:"867",height:"238"})),(0,s.kt)("p",null,"Le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-ComputerName")," est de type ",(0,s.kt)("inlineCode",{parentName:"p"},"string[]"),", donc il est possible de lui donner plusieurs ordinateurs, ou encore de lui passer un tableau de strings."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(25006).Z,width:"867",height:"178"})),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(36481).Z,width:"867",height:"188"})),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"M\xeame si le nom du param\xe8tre sugg\xe8re qu'on doive passer un nom d'ordinateur, on peut aussi passer l'adresse IP num\xe9rique de l'ordinateur ou encore le nom DNS complet (FQDN). Dans un environnement de domaine simple, on tend souvent \xe0 n'indiquer que le nom de l'ordinateur, puisque les machines membres du domaine vont automatiquement appliquer le suffixe DNS de leur domaine. "),(0,s.kt)("p",{parentName:"admonition"},"Concernant les r\xe9solutions de nom court: Par exemple, si on tente de r\xe9soudre le serveur ",(0,s.kt)("em",{parentName:"p"},"SRV01")," sur une machine client membre du domaine ",(0,s.kt)("em",{parentName:"p"},"auto.cemti.ca"),", la r\xe9solution r\xe9elle se fera sur ",(0,s.kt)("em",{parentName:"p"},"SRV01.auto.cemti.ca"),". ")),(0,s.kt)("h3",{id:"pr\xe9paration"},"Pr\xe9paration"),(0,s.kt)("p",null,"Dans plusieurs cas, l'administration \xe0 distance de Windows est d\xe9sactiv\xe9e pour des raisons de s\xe9curit\xe9. On l'active au besoin. Dans plusieurs entreprises, o\xf9 la gestion des ordinateurs \xe0 distance est importante, ces configurations sont automatis\xe9es."),(0,s.kt)("h4",{id:"pare-feu"},"Pare-feu"),(0,s.kt)("p",null,"WMI repose sur DCOM et RPC, deux protocoles d'administration \xe0 distance int\xe9gr\xe9s \xe0 Windows. Ceux-ci sont actifs par d\xe9faut sous Windows, mais le pare-feu bloque le trafic provenant de l'ext\xe9rieur. Pour permettre de passer des requ\xeates WMI \xe0 une machine distante, il faut ouvrir le pare-feu des machine sur lesquelles vous voulez vous connecter."),(0,s.kt)("p",null,'Pour ce faire, d\xe9marrez la console avanc\xe9e du pare-feu de Windows (wf.msc) et activez l\'ensemble de r\xe8gles du groupe "Windows Management Instrumentation".'),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(59344).Z,width:"571",height:"140"})),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(17943).Z,width:"738",height:"395"})),(0,s.kt)("p",null,"Vous pouvez maintenant tester la connexion en sp\xe9cifiant les param\xe8tres ",(0,s.kt)("inlineCode",{parentName:"p"},"ComputerName")," et ",(0,s.kt)("inlineCode",{parentName:"p"},"Credential")," (si n\xe9cessaire)."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(68886).Z,width:"869",height:"215"})),(0,s.kt)("h3",{id:"get-credential"},"Get-Credential"),(0,s.kt)("p",null,"Pour administrer une machine \xe0 distance, il faut minimalement avoir les privil\xe8ges pour l'administrer."),(0,s.kt)("p",null,"Dans un domaine Active Directory, l'authentification est g\xe9n\xe9ralement int\xe9gr\xe9e. Lorsque vous ouvrez une session sur votre machine avec votre compte AD, c'est ce m\xeame compte qui sera automatiquement pass\xe9 \xe0 la machine distante que vous tentez d'administrer. Cela simplifie beaucoup les choses."),(0,s.kt)("p",null,"Lorsqu'on veut poser une action sur un serveur distant avec un compte diff\xe9rent de celui dont on s'est servi pour s'authentifier \xe0 notre machine, une mani\xe8re de proc\xe9der est par l'emploi de la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-Credential"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(26030).Z,width:"708",height:"382"})),(0,s.kt)("p",null,"L'objet retourn\xe9 est de type ",(0,s.kt)("inlineCode",{parentName:"p"},"PSCredential")," et est le type d'objet \xe0 passer lorsqu'une commande poss\xe8de un param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"Credential")),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(43377).Z,width:"869",height:"270"})),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"On ne devrait jamais utiliser ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-Credential")," dans un script ou une fonction, car cela force une action de l'utilisateur m\xeame s'il poss\xe8de d\xe9j\xe0 des droits suffisants. \xc7a l'obligerait \xe0 se r\xe9authentifier \xe0 chaque lancement du script. On ne devrait utiliser ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-Credential")," que lorsque l'utilisateur doit utiliser un compte diff\xe9rent que celui avec lequel il op\xe8re sa session PowerShell."),(0,s.kt)("p",{parentName:"admonition"},"En fait, on devrait plut\xf4t cr\xe9er un param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-Credential")," non-obligatoire dont la valeur par d\xe9faut est un jeton vide."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},"[CmdletBinding()]\nParam(\n    [System.Management.Automation.PSCredential]\n    $Credential = [System.Management.Automation.PSCredential]::Empty\n)\n")),(0,s.kt)("p",{parentName:"admonition"},"On passe alors ",(0,s.kt)("inlineCode",{parentName:"p"},"$Credential")," dans les param\xe8tres ",(0,s.kt)("inlineCode",{parentName:"p"},"-Credential")," des commandes qui sont appel\xe9es. Si le param\xe8tre n'a pas \xe9t\xe9 sp\xe9cifi\xe9 au lancement du script, le jeton est vide, et cela indique \xe0 la commande d'ex\xe9cuter la commande au nom de l'utilisateur qui l'appelle."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("inlineCode",{parentName:"p"},"Get-Credential")," devrait seulement \xeatre utilis\xe9 au moment d'appeler le script, au besoin."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},".\\MonScript.ps1 -Credential (Get-Credential)\n"))),(0,s.kt)("h3",{id:"objets-pscredential"},"Objets PSCredential"),(0,s.kt)("p",null,"Creusons un peu dans l'objet ",(0,s.kt)("inlineCode",{parentName:"p"},"PSCredential"),"."),(0,s.kt)("p",null,"Cet objet poss\xe8de deux propri\xe9t\xe9s: ",(0,s.kt)("inlineCode",{parentName:"p"},"UserName")," et ",(0,s.kt)("inlineCode",{parentName:"p"},"Password"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(97967).Z,width:"989",height:"349"})),(0,s.kt)("p",null,"Pourtant, le mot de passe n'est pas visible. Il s'agit d'un objet ",(0,s.kt)("inlineCode",{parentName:"p"},"SecureString"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(84651).Z,width:"989",height:"212"})),(0,s.kt)("p",null,"Les objets ",(0,s.kt)("inlineCode",{parentName:"p"},"SecureString")," servent principalement \xe0 stocker des mots de passe de mani\xe8re s\xe9curitaire. On peut leur affecter une cha\xeene de caract\xe8res, mais on ne peut pas la lire. Le mot de passe contenu dans cet objet est chiffr\xe9."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(16797).Z,width:"989",height:"506"})),(0,s.kt)("h3",{id:"rpc-et-winrm"},"RPC et WinRM"),(0,s.kt)("p",null,"Le syst\xe8me d'exploitation Windows offre plusieurs options pour permettre aux administrateurs syst\xe8mes de les administrer \xe0 distance, \xe0 travers le r\xe9seau."),(0,s.kt)("p",null,"Nous avons vu pr\xe9c\xe9demment comment les requ\xeates WMI, \xe0 l'aide de la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-WmiObject"),", peuvent \xeatre pass\xe9es \xe0 des h\xf4tes distants. C'est possible au moyen du protocole RPC (Remote Procedure Call), un protocole datant des ann\xe9es 80. Microsoft a utilis\xe9 RPC dans ses outils de gestion d\xe8s les d\xe9buts de Windows NT, dans les ann\xe9es 90, et est encore aujourd'hui largement utilis\xe9. C'est ce protocole qui permet l'administration \xe0 distance avec WMI et les consoles de gestion MMC (comme Computer Management)."),(0,s.kt)("p",null,"RPC n'a pas \xe9t\xe9 con\xe7u pour la s\xe9curit\xe9, qui n'\xe9tait pas un grand enjeu \xe0 l'\xe9poque. Microsoft a fait \xe9voluer le protocole, lui greffant des routines de s\xe9curit\xe9, mais \xe7a a donn\xe9 un protocole tr\xe8s complexe et fragile. La nature du protocole oblige, entre autres, \xe0 ouvrir un tr\xe8s grand nombre de ports entrants (tous les ports de 1024-65535, \xe9ventuellement r\xe9duit \xe0 49152-65535), ce qui \xe9largit la surface d'exposition \xe0 des menaces ext\xe9rieures. Aussi, le trafic RPC n'est g\xe9n\xe9ralement pas chiffr\xe9 (\xe0 l'exception des credentials)."),(0,s.kt)("p",null,"Microsoft a donc d\xe9velopp\xe9 un nouveau protocole d'administration \xe0 distance pour Windows, avec cette fois-ci la s\xe9curit\xe9 en t\xeate. Ce protocole, c'est WinRM. Il est bas\xe9 sur HTTP/HTTPS, comme pour le Web."),(0,s.kt)("h3",{id:"activation-de-winrm-sur-un-serveur"},"Activation de WinRM sur un serveur"),(0,s.kt)("p",null,"Pour activer WinRM sur une machine (la machine qui va recevoir la connexion), on peut utiliser la commande suivante, dans une console powershell \xe9lev\xe9e (en tant qu'administrateur)"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},"Enable-PSRemoting -Force\n")),(0,s.kt)("p",null,"Si WinRM est d\xe9j\xe0 activ\xe9, la commande vous le dira. Sinon, la commande se chargera d'activer WinRM pour vous, incluant le service et le pare-feu."),(0,s.kt)("p",null,"On peut \xe9galement utiliser la commande winrm quickconfig pour arriver au m\xeame r\xe9sultat."),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Si votre serveur n'est pas dans un domaine, on peut activer WinRM mais la proc\xe9dure est diff\xe9rente."),(0,s.kt)("p",{parentName:"admonition"},"Comme le profil de connexion n'est pas celle d'un domaine, Windows le consid\xe8re moins s\xe9curitaire. Si votre serveur est connect\xe9 dans un environnement que vous consid\xe9rez s\xe9curitaire (un r\xe9seau local d'entreprise par exemple), vous pouvez demander de sauter la v\xe9rification."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},"Enable-PSRemoting -Force -SkipNetworkProfileCheck\n")),(0,s.kt)("p",{parentName:"admonition"},"Aussi, il faut pr\xe9ciser la liste des machines de confiance. Lorsqu'on est dans un domaine, toutes les machines membres du domaine sont dignes de confiance. Lorsqu'on n'est pas dans un domaine, on doit les d\xe9finir."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},'Set-Item WSMAN:\\localhost\\Client\\TrustedHosts -Value "192.168.123.45" -Force\n')),(0,s.kt)("p",{parentName:"admonition"},"Si vous voulez accepter la connexion de n'importe quelle machine du r\xe9seau, vous pouvez mettre * comme valeur. Mais sachez que ce n'est pas une bonne pratique de s\xe9curit\xe9."),(0,s.kt)("p",{parentName:"admonition"},"Ensuite, red\xe9marrez le service WinRM pour que les changements soient pris en compte."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},"Restart-Service WinRM\n"))),(0,s.kt)("h4",{id:"le-pare-feu"},"Le pare-feu"),(0,s.kt)("p",null,"Normalement, la r\xe8gle de pare-feu est cr\xe9\xe9e automatiquement. Vous pouvez vous en assurer dans la console du pare-feu (wf.msc)."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(6534).Z,width:"810",height:"281"})),(0,s.kt)("h4",{id:"chiffrement"},"Chiffrement"),(0,s.kt)("p",null,"Une bonne pratique, lorsqu'on active WinRM, est de permettre le chiffrement du trafic. Par d\xe9faut, c'est HTTP qui est utilis\xe9 et pas HTTPS. Pour permettre le chiffrement du trafic, tout comme avec HTTPS pour le Web, on a besoin d'un certificat SSL. On n'entrera pas dans ces d\xe9tails dans le cadre de ce cours, mais si \xe7a vous int\xe9resse, consultez ce guide: ",(0,s.kt)("a",{parentName:"p",href:"https://4sysops.com/archives/powershell-remoting-over-https-with-a-self-signed-ssl-certificate/"},"https://4sysops.com/archives/powershell-remoting-over-https-with-a-self-signed-ssl-certificate/"),"."),(0,s.kt)("h2",{id:"sessions-powershell-\xe0-distance"},"Sessions PowerShell \xe0 distance"),(0,s.kt)("p",null,"Une fois que WinRM a \xe9t\xe9 activ\xe9 sur le serveur, vous pouvez maintenant vous y ouvrir une session PowerShell distante. Pour ce faire, utilisez les commandes dont le nom est PSSession."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(98311).Z,width:"510",height:"360"})),(0,s.kt)("p",null,"Pour acc\xe9der \xe0 la ligne de commande \xe0 distance, la commande \xe0 utiliser est ",(0,s.kt)("inlineCode",{parentName:"p"},"Enter-PSSession"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(58731).Z,width:"621",height:"109"})),(0,s.kt)("p",null,"Une fois dans la session distante, on voit le nom du serveur dans l'invite. Toutes les commandes qu'on tape ici seront faites comme si nous \xe9tions physiquement sur le serveur."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(20789).Z,width:"681",height:"233"})),(0,s.kt)("p",null,"Pour quitter la session, vous pouvez utiliser la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Exit-PSSession"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(38519).Z,width:"654",height:"118"})),(0,s.kt)("h3",{id:"authentification"},"Authentification"),(0,s.kt)("p",null,"Dans un environnement Active Directory, on se connecte au serveur distant en utilisant par d\xe9faut l'identit\xe9 de l'utilisateur pr\xe9sentement logg\xe9. On peut utiliser le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-Credential")," pour sp\xe9cifier un utilisateur diff\xe9rent."),(0,s.kt)("p",null,"En entreprise, il n'est pas rare de recourir \xe0 cette fa\xe7on de faire. Les utilisateurs (m\xeame les admins) utilisent un compte r\xe9gulier, sans droits d'administration, pour travailler sur leur poste de travail. Ils ont un deuxi\xe8me compte, qu'ils utilisent pour se connecter \xe0 des sessions distantes, et c'est ce compte qui poss\xe8de les droits d'administration."),(0,s.kt)("p",null,"Dans cet exemple, l'utilisateur du syst\xe8me est logg\xe9 avec le compte alice, qui n'a aucun droit d'administration. Lorsqu'on tente de se connecter sur le serveur, l'acc\xe8s est refus\xe9."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(29762).Z,width:"987",height:"335"})),(0,s.kt)("p",null,"Pour se connecter en tant qu'un utilisateur qui poss\xe8de des droits sur ce syst\xe8me, il faut sp\xe9cifier les credentials. On les obtient avec ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-Credential"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(77873).Z,width:"543",height:"434"})),(0,s.kt)("p",null,"Et on passe cet objet dans le param\xe8tre -Credential."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(26527).Z,width:"708",height:"206"})),(0,s.kt)("h3",{id:"cr\xe9er-des-sessions-powershell"},"Cr\xe9er des sessions PowerShell"),(0,s.kt)("p",null,"Les sessions interactives, c'est bien, mais on doit faire toutes nos commandes dans l'ordinateur distant. Si on a un script \xe0 ex\xe9cuter, il faut d'abord le transf\xe9rer sur l'ordinateur distant, ce qui n'est pas pratique."),(0,s.kt)("p",null,"On peut ouvrir des sessions PowerShell \xe0 distance, non pas pour acc\xe9der \xe0 la console, mais pour y lancer des commandes."),(0,s.kt)("h4",{id:"cr\xe9er-la-session"},"Cr\xe9er la session"),(0,s.kt)("p",null,"On cr\xe9er une nouvelle session avec la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"New-PSSession"),". Celle-ci sera ouverte et portera un num\xe9ro d'identification."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(87297).Z,width:"912",height:"195"})),(0,s.kt)("h4",{id:"obtenir-les-sessions-existantes"},"Obtenir les sessions existantes"),(0,s.kt)("p",null,"On peut obtenir l'\xe9tat des sessions en cours avec ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-PSSession"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(59026).Z,width:"856",height:"209"})),(0,s.kt)("h4",{id:"affecter-une-session-\xe0-une-variable"},"Affecter une session \xe0 une variable"),(0,s.kt)("p",null,"Pour obtenir une session sp\xe9cifique et la mettre dans une variable, on peut l'affecter avec ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-PSSession")," si la session est d\xe9j\xe0 ouverte, ou encore, l'affecter directement avec ",(0,s.kt)("inlineCode",{parentName:"p"},"New-PSSession"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(28233).Z,width:"860",height:"219"})),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(39431).Z,width:"893",height:"333"})),(0,s.kt)("h4",{id:"terminer-une-session"},"Terminer une session"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(85428).Z,width:"631",height:"142"})),(0,s.kt)("h4",{id:"terminer-toutes-les-sessions-ouvertes"},"Terminer toutes les sessions ouvertes"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(89079).Z,width:"582",height:"135"})),(0,s.kt)("h3",{id:"invoke-command"},"Invoke-Command"),(0,s.kt)("p",null,"La commande Invoke-Command ex\xe9cute une commande \xe0 distance. Elle est \xe9quivalente \xe0 appeler powershell.exe sur la machine distante."),(0,s.kt)("p",null,"On peut l'utiliser de deux mani\xe8res."),(0,s.kt)("h4",{id:"ex\xe9cuter-un-bloc-de-commandes"},"Ex\xe9cuter un bloc de commandes"),(0,s.kt)("p",null,"Le bloc de commandes se d\xe9finit avec le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-ScriptBlock"),", entre accolades. C'est pratique pour lancer une commande simple sur les machines distantes."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(61315).Z,width:"864",height:"220"})),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("p",{parentName:"admonition"},"Une session PSSession \xe0 distance correspond \xe0 une session PowerShell ouverte sur une autre machine. Par cons\xe9quent, elle est distincte de la session locale. Par exemple, une variable qu'on d\xe9finit dans la session locale ne sera pas accessible sur la session distante."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},'$NouveauDossier = "C:\\MonDossier"\n$Session = New-PSSession -ComputerName "SRV01"\n\nInvoke-Command -Session $Session -ScriptBlock { \n    New-Item -Path $NouveauDossier -ItemType Directory  # Ne fonctionnera pas!\n}\n')),(0,s.kt)("p",{parentName:"admonition"},"L'exemple pr\xe9c\xe9dent ne fonctionnera pas, puisque la variable ",(0,s.kt)("inlineCode",{parentName:"p"},"$NouveauDossier")," n'a jamais \xe9t\xe9 cr\xe9\xe9e dans la session distante. Elle n'existe que dans la session locale."),(0,s.kt)("p",{parentName:"admonition"},"Pour pouvoir r\xe9cup\xe9rer une variable locale dans un bloc de code \xe0 envoyer \xe0 une machine distante, il faut utiliser le pr\xe9fixe ",(0,s.kt)("inlineCode",{parentName:"p"},"$using:")," avant le nom de la variable."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},'$NouveauDossier = "C:\\MonDossier"\n$Session = New-PSSession -ComputerName "SRV01"\n\nInvoke-Command -Session $Session -ScriptBlock { \n    New-Item -Path $using:NouveauDossier -ItemType Directory\n}\n')),(0,s.kt)("p",{parentName:"admonition"},"On peut aussi effectuer un ",(0,s.kt)("em",{parentName:"p"},"splatting")," avec un hashtable d\xe9fini localement dans une commande distante avec le pr\xe9fixe ",(0,s.kt)("inlineCode",{parentName:"p"},"@using:"),", de la m\xeame mani\xe8re."),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-powershell"},'$NouveauDossierSplat = @{\n    Path = "C:\\MonDossier"\n    ItemType = "Directory"\n}\n$Session = New-PSSession -ComputerName "SRV01"\n\nInvoke-Command -Session $Session -ScriptBlock { \n    New-Item @using:NouveauDossierSplat\n}\n'))),(0,s.kt)("h4",{id:"ex\xe9cuter-un-script"},"Ex\xe9cuter un script"),(0,s.kt)("p",null,"Lorsqu'on a un plus grand nombre de commandes \xe0 lancer sur la machine distante, on peut appeler un script."),(0,s.kt)("p",null,"Dans cet exemple, on cr\xe9e un script tout simple compos\xe9 seulement de la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Get-Process"),", mais \xe7a pourrait \xeatre un script beaucoup plus complexe. Ce script sera lanc\xe9 dans la session distante."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(74083).Z,width:"859",height:"274"})),(0,s.kt)("h4",{id:"sp\xe9cifier-les-noms-de-machines-au-lieu-des-sessions"},"Sp\xe9cifier les noms de machines au lieu des sessions"),(0,s.kt)("p",null,"On peut aussi cr\xe9er les sessions automatiquement, en sp\xe9cifiant les noms de machines plut\xf4t que des sessions, mais si vous avez plusieurs commandes \xe0 lancer, il sera plus pratique de r\xe9utiliser la m\xeame session pour chacune des commandes au lieu de les r\xe9initier \xe0 chaque fois."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(47734).Z,width:"918",height:"208"})),(0,s.kt)("h3",{id:"psremoting-et-pipeline"},"PSRemoting et pipeline"),(0,s.kt)("p",null,"Comme c'est une session PowerShell, ce qui sort de la commande distante, c'est un objet. Et cet objet sort sur le pipeline local du client. Autrement dit, quand la commande est lanc\xe9e \xe0 distance, ce qu'elle laisse dans le pipeline revient \xe0 l'appelant, et nous pouvons manipuler cet objet \xe0 notre guise."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(53440).Z,width:"987",height:"294"})),(0,s.kt)("p",null,"On peut aussi affecter cet objet dans une variable."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(36297).Z,width:"987",height:"310"})),(0,s.kt)("h3",{id:"plusieurs-sessions-en-m\xeame-temps"},"Plusieurs sessions en m\xeame temps"),(0,s.kt)("p",null,"On peut lancer une commande sur plusieurs sessions d'un coup. "),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(26997).Z,width:"987",height:"438"})),(0,s.kt)("h3",{id:"copie-de-fichiers-\xe0-travers-une-session"},"Copie de fichiers \xe0 travers une session"),(0,s.kt)("p",null,"Il est possible de copier un fichier \xe0 travers une session PSRemoting \xe0 l'aide de la commande ",(0,s.kt)("inlineCode",{parentName:"p"},"Copy-Item"),"."),(0,s.kt)("h4",{id:"de-la-machine-locale-vers-la-machine-distante"},"De la machine locale vers la machine distante"),(0,s.kt)("p",null,"Si on sp\xe9cifie le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-ToSession"),", on envoie le fichier vers la machine cible. Le param\xe8tre -Path repr\xe9sente donc le chemin sur la machine locale, et le param\xe8tre -Destination repr\xe9sente le chemin sur la machine distante."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(80806).Z,width:"900",height:"135"})),(0,s.kt)("h4",{id:"de-la-machine-distante-vers-la-machine-locale"},"De la machine distante vers la machine locale"),(0,s.kt)("p",null,"\xc0 l'inverse, si on sp\xe9cifie le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-FromSession"),", alors on tire le fichier de l'ordinateur distant vers l'ordinateur local. Le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-Path")," repr\xe9sente alors le chemin sur la machine distante, et le param\xe8tre ",(0,s.kt)("inlineCode",{parentName:"p"},"-Destination"),", celui sur la machine locale."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(64305).Z,width:"900",height:"135"})),(0,s.kt)("h2",{id:"le-planificateur-de-t\xe2ches"},"Le planificateur de t\xe2ches"),(0,s.kt)("p",null,"Le planificateur de t\xe2ches sert, comme son nom l'indique, \xe0 planifier des op\xe9rations sous Windows afin qu'elles d\xe9marrent automatiquement selon certains crit\xe8res et dans certaines conditions. Il est tr\xe8s utile dans de nombreux contextes, comme la planification de t\xe2ches de maintenance r\xe9guli\xe8res, le d\xe9marrage d'op\xe9rations automatique au d\xe9marrage du syst\xe8me ou \xe0 l'ouverture d'une session utilisateur, le nettoyage automatique de fichiers temporaires, la prise de sauvegardes r\xe9guli\xe8res, etc."),(0,s.kt)("p",null,"Avec l'interface graphique, on utilise la console MMC du planificateur de t\xe2ches, ",(0,s.kt)("inlineCode",{parentName:"p"},"taskschd"),", ou encore la console de gestion de l'ordinateur, ",(0,s.kt)("inlineCode",{parentName:"p"},"compmgmt.msc"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(25554).Z,width:"448",height:"252"})),(0,s.kt)("p",null,'Les t\xe2ches planifi\xe9es sont organis\xe9es sous forme d\'arborescence. La racine (nomm\xe9e "biblioth\xe8que du planificateur de t\xe2ches", ou simplement, ',(0,s.kt)("strong",{parentName:"p"},"/"),") contient un certain nombre de t\xe2ches planifi\xe9es d\xe9j\xe0 mises en place \xe0 l'installation de Windows ou d'un logiciel, mais d'autres t\xe2ches sont stock\xe9es dans des conteneurs sous la racine."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(16672).Z,width:"572",height:"446"})),(0,s.kt)("p",null,"Pour cr\xe9er une t\xe2che \xe0 l'aide de l'interface graphique, il suffit d'ouvrir le menu contextuel par un clic-droit sur le conteneur o\xf9 cr\xe9er la t\xe2che. Il existe deux mani\xe8re de cr\xe9er une t\xe2che: simplifi\xe9e (\"",(0,s.kt)("em",{parentName:"p"},"cr\xe9er une t\xe2che de base..."),'") et avanc\xe9e ("',(0,s.kt)("em",{parentName:"p"},"cr\xe9er une t\xe2che..."),'"). Il est pr\xe9f\xe9rable de ne pas choisir une t\xe2che de base, puisque certaines options sont inaccessibles.'),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(22782).Z,width:"486",height:"422"})),(0,s.kt)("h3",{id:"composition-dune-t\xe2che-planifi\xe9e"},"Composition d'une t\xe2che planifi\xe9e"),(0,s.kt)("p",null,"Une t\xe2che planifi\xe9e est en ensemble de plusieurs \xe9l\xe9ments d'information. Ils sont assembl\xe9s ensemble pour former une t\xe2che planifi\xe9e incrite dans le planificateur."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(60125).Z,width:"371",height:"270"})),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"L'information d'enregistrement (",(0,s.kt)("strong",{parentName:"p"},"RegistrationInfo"),") contient les propri\xe9t\xe9s de la t\xe2che qui concernent son enregistrement dans le planificateur, comme le nom de la t\xe2che, sa description et son emplacement dans l'arborescence du planificateur.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Les d\xe9clencheurs (",(0,s.kt)("strong",{parentName:"p"},"Trigger"),") d\xe9finissent dans quelle circonstance la t\xe2che pourra \xeatre lanc\xe9e. Par exemple, au d\xe9marrage de l'ordinateur, \xe0 l'ouverture de session, \xe0 chaque vendredi minuit, ou m\xeame lorsqu'un \xe9v\xe9nement syst\xe8me est d\xe9tect\xe9. Il peut y en avoir plus d'un.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Les actions (",(0,s.kt)("strong",{parentName:"p"},"Action"),") d\xe9finissent une action (comme le lancement d'une commande ou d'un script) \xe0 ex\xe9cuter chaque fois que la t\xe2che est d\xe9clench\xe9e. Il peut y en avoir plusieurs.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Le principal de s\xe9curit\xe9 (",(0,s.kt)("strong",{parentName:"p"},"Principal"),") d\xe9crit avec quelle identit\xe9 (un compte utilisateur ou un groupe) la t\xe2che sera lanc\xe9e. Si le principal est un compte utilisateur, alors c'est sous ce compte que la t\xe2che sera ex\xe9cut\xe9e (comme si l'utilisateur l'avait fait manuellement). Si le principal est un groupe, la t\xe2che sera lanc\xe9e au nom de l'utilisateur courant uniquement s'il est membre de ce groupe.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Les param\xe8tres (",(0,s.kt)("strong",{parentName:"p"},"Settings"),") d\xe9crivent diverses options concernant la t\xe2che. Par exemple, la t\xe2che doit-elle \xeatre ex\xe9cut\xe9e m\xeame si l'ordinateur tourne sur la batterie, ou le comportement \xe0 adopter si la t\xe2che \xe9choue."))),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(21724).Z,width:"808",height:"490"})),(0,s.kt)("h3",{id:"d\xe9clencheur-trigger"},"D\xe9clencheur (",(0,s.kt)("em",{parentName:"h3"},"Trigger"),")"),(0,s.kt)("p",null,"Une t\xe2che planifi\xe9e comprend un ou plusieurs d\xe9clencheurs, c'est-\xe0-dire des \xe9v\xe9nements qui d\xe9marreront automatiquement la t\xe2che."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(17213).Z,width:"856",height:"534"})),(0,s.kt)("p",null,"Plusieurs types de d\xe9clencheurs sont disponibles:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\xc0 l'heure programm\xe9e"),(0,s.kt)("li",{parentName:"ul"},"\xc0 l'ouverture de session"),(0,s.kt)("li",{parentName:"ul"},"Au d\xe9marage"),(0,s.kt)("li",{parentName:"ul"},"Apr\xe8s une p\xe9riode d'activit\xe9 "),(0,s.kt)("li",{parentName:"ul"},"Sur un \xe9v\xe9nement (syst\xe8me)"),(0,s.kt)("li",{parentName:"ul"},"Lors de la cr\xe9ation/modification de la t\xe2che"),(0,s.kt)("li",{parentName:"ul"},"Au moment de la connexion \xe0 une session utilisateur (par exemple, RDP)"),(0,s.kt)("li",{parentName:"ul"},"Au moment de la d\xe9connexion \xe0 une session utilisateur"),(0,s.kt)("li",{parentName:"ul"},"Au verrouillage du poste de travail (Win+L)"),(0,s.kt)("li",{parentName:"ul"},"Au d\xe9verrouillage du poste de travail")),(0,s.kt)("h3",{id:"action-action"},"Action (",(0,s.kt)("em",{parentName:"h3"},"Action"),")"),(0,s.kt)("p",null,"Une t\xe2che planifi\xe9e comprend une ou plusieurs actions qui seront lanc\xe9es lorsque la t\xe2che sera d\xe9clench\xe9e. Le principal type d'action est le lancement d'une commande (\"",(0,s.kt)("em",{parentName:"p"},"d\xe9marrer un programme"),'").'),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(61933).Z,width:"642",height:"246"})),(0,s.kt)("p",null,"Pour lancer une commande, il faut d\xe9finir trois param\xe8tres:"),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"Param\xe8tre"),(0,s.kt)("th",{parentName:"tr",align:null},"Description"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Programme/script"),(0,s.kt)("td",{parentName:"tr",align:null},"Le nom ou chemin du fichier ex\xe9cutable \xe0 appeler seulement.")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Ajouter des arguments (facultatif)"),(0,s.kt)("td",{parentName:"tr",align:null},"Tous les arguments apr\xe8s le nom de l'ex\xe9cutable.")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Commencer dans (facultatif)"),(0,s.kt)("td",{parentName:"tr",align:null},"Le r\xe9pertoire de travail dans lequel lancer la commande.")))),(0,s.kt)("p",null,"Par exemple, pour qu'une t\xe2che ex\xe9cute le script PowerShell ",(0,s.kt)("inlineCode",{parentName:"p"},"C:\\Scripts\\MonScript.ps1"),", il faudrait que le nom du programme soit ",(0,s.kt)("inlineCode",{parentName:"p"},"powershell.exe")," et que les arguments soient ",(0,s.kt)("inlineCode",{parentName:"p"},"-File C:\\Scripts\\MonScript.ps1 -ExecutionPolicy Bypass"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(75527).Z,width:"464",height:"299"})),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Pour conna\xeetre la syntaxe de la commande Powershell.exe, vous pouvez lancer ",(0,s.kt)("inlineCode",{parentName:"p"},"Powershell.exe /?")," pour acc\xe9der \xe0 la rubrique d'aide."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("img",{src:n(86201).Z,width:"730",height:"281"}))),(0,s.kt)("h3",{id:"conditions-et-param\xe8tres"},"Conditions et param\xe8tres"),(0,s.kt)("p",null,"Les onglets Conditions et Param\xe8tres contiennent des options suppl\xe9mentaires sur la t\xe2che."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(56929).Z,width:"587",height:"448"})),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(64584).Z,width:"587",height:"448"})),(0,s.kt)("h3",{id:"forcer-le-lancement-une-t\xe2che-planifi\xe9e"},"Forcer le lancement une t\xe2che planifi\xe9e"),(0,s.kt)("p",null,"On peut forcer l'ex\xe9cution d'une t\xe2che planifi\xe9e directement par la console. C'est pratique pour la tester."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(39880).Z,width:"1018",height:"360"})),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Comme bien des consoles MMC, vous pouvez g\xe9rer les t\xe2ches planifi\xe9es sur une machine distante \xe0 partir de la console. Vous devez \xeatre administrateur local de la machine distante, et les pare-feux doivent laisser passer le protocole MSRPC."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("img",{src:n(47172).Z,width:"592",height:"431"}))),(0,s.kt)("h2",{id:"gestion-des-t\xe2ches-planifi\xe9es-en-powershell"},"Gestion des t\xe2ches planifi\xe9es en PowerShell"),(0,s.kt)("p",null,"PowerShell offre un ensemble de commandes pour contr\xf4ler, localement ou \xe0 distance, les t\xe2ches planifi\xe9es."),(0,s.kt)("p",null,"Pour ce faire, il y a plusieurs commandes \xe0 faire, puisqu'il faut cr\xe9er chaque \xe9l\xe9ment de la t\xe2che planifi\xe9e individuellement, puis les mettre ensemble pour l'enregistrer dans la biblioth\xe8que du planificateur de t\xe2ches."),(0,s.kt)("h3",{id:"d\xe9finir-le-d\xe9clencheur"},"D\xe9finir le d\xe9clencheur"),(0,s.kt)("p",null,"Il existe plusieurs d\xe9clencheurs. Il suffit ici de cr\xe9er un nouveau d\xe9clencheur du type souhait\xe9. Il faut le stocker dans une variable."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(46542).Z,width:"730",height:"235"})),(0,s.kt)("h3",{id:"d\xe9finir-laction"},"D\xe9finir l'action"),(0,s.kt)("p",null,"Il faut d\xe9finir l'action, soit le programme a ex\xe9cuter. Tout comme avec l'interface graphique, le programme \xe0 sp\xe9cifier dans le param\xe8tre -Execute n'est que l'ex\xe9cutable \xe0 lancer. Si c'est un script PowerShell, alors on met \"powershell.exe\". Si c'est un autre programme, on met uniquement le nom du programme, sans ses arguments."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(988).Z,width:"730",height:"236"})),(0,s.kt)("h3",{id:"d\xe9finir-le-principal"},"D\xe9finir le principal"),(0,s.kt)("p",null,"Le principal d\xe9signe l'utilisateur au nom duquel la t\xe2che sera ex\xe9cut\xe9e."),(0,s.kt)("p",null,"Nous avons deux options:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Sp\xe9cifier un compte utilisateur sp\xe9cifique (",(0,s.kt)("inlineCode",{parentName:"li"},"-UserID"),")"),(0,s.kt)("li",{parentName:"ul"},"Sp\xe9cifier un groupe (",(0,s.kt)("inlineCode",{parentName:"li"},"-GroupID"),")")),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(66164).Z,width:"730",height:"266"})),(0,s.kt)("p",null,"Si le principal est un utilisateur, la t\xe2che sera faite au nom de ce compte pr\xe9cis."),(0,s.kt)("p",null,"Si le principal est un groupe, la t\xe2che sera faite au nom de l'utilisateur courant, uniquement si celui-ci fait partie du groupe. Lorsque le principal est un groupe, il est impossible que la t\xe2che soit lanc\xe9e lorsque l'utilisateur n'est pas logg\xe9."),(0,s.kt)("h3",{id:"enregistrer-la-t\xe2che-planifi\xe9e"},"Enregistrer la t\xe2che planifi\xe9e"),(0,s.kt)("p",null,"Une fois tous les \xe9l\xe9ments en place, il ne reste plus qu'\xe0 enregistrer la t\xe2che planifi\xe9e. On lui donne alors un nom, une description et un emplacement dans le planificateur, puis on lui donne une ou plusieurs actions, un ou plusieurs d\xe9clencheurs ainsi qu'un principal."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(55302).Z,width:"729",height:"181"})),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Il est aussi possible de contr\xf4ler les t\xe2ches planifi\xe9es sur un ordinateur distant. On peut simplement passer par une session distante (PSSession) au moyen de la commande Invoke-Command."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("img",{src:n(89141).Z,width:"570",height:"270"}))))}h.isMDXComponent=!0},26030:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pscredential_01-c4a520ec11f77d9861d756e87cddb1cb.png"},43377:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pscredential_02-730ca80f852002f9541b400d4f798644.png"},97967:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pscredential_04-9c34a7eda707e5883b007a7229fb8aa3.png"},84651:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pscredential_05-f0ba38769a6f82c5321a282d304ec67c.png"},16797:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pscredential_06-47c32e118e7b71803836bb20352a425e.png"},98311:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_01-79f4fd51a3f0c7c8416b8e2543631aec.png"},58731:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_02-0baf0ac22364e937d2275df43483afe3.png"},20789:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_03-f8e9936d6baadfaac6bc9d2bb9e19637.png"},38519:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_04-4647b1f82529f6ab1ea2ef7603e18bda.png"},87297:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_05-389e1e20e6aeb3f4af0c6965e1535693.png"},59026:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_06-b27c8a3097e48144dc4e07b65d67008e.png"},28233:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_07-822e87d6dcbc72facc753d7bb8c2f6f9.png"},39431:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_08-7033312a55483d99dc3e1e2d80b48274.png"},85428:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_09-10edea638bdd05eb2a908f09155505c1.png"},89079:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_10-7b520530c7ff0f26ebc26ce3b365a4a7.png"},29762:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_auth_01-baf9bf3c09ac2f3c208ecbaf24694a6e.png"},77873:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_auth_02-a3ae175d4cfd49d1de2c7cf02e4a8a99.png"},26527:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_auth_03-b071515592a6aa60d841f8a0f497350b.png"},80806:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_copy-item_01-9a5c9aa65d7f977b8df9fecaf6a965cc.png"},64305:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_copy-item_02-c5140316a06de6dd09d33060091ed26b.png"},61315:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_01-847b111d7162dc08fa5efa9d2565254b.png"},74083:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_02-e3e99ef765c9aeb2f3e8c2745b2fc4c3.png"},47734:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_03-3eb0109e76f7529cf1b32b4767d8b50b.png"},53440:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_04-7e7d2b98b8d2e382d411b87e24a83661.png"},36297:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_05-60552e02bd41a339dc1391c1cc6d3c42.png"},26997:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/psremoting_invoke-command_06-9240c20bade96126117d8fe5f88b6fae.png"},25554:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_01-083757c0f53310935feb5cdd4e98ea8d.png"},16672:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_02-56d205cd86506626b5a50f4fbd96e63b.png"},22782:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_03-dd911f0b064bd012be01833832e1b049.png"},21724:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_04-1a8d02d3a5e551dbe924eb3e1953b1f2.png"},60125:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_05-9a17c24b66a27486d7717196943ce633.png"},61933:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_action01-7000678738875d6441dedd82e6bcdcd7.png"},75527:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_action02-8ebfbbf359478f172106f7c37269709c.png"},86201:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_action03-05a32e074505d251f1289f42f4db7498.png"},56929:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_condition01-92ea24c0d9d242fe1b1678d3faeda799.png"},39880:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_forceexec-605db66f9dce228b23b516bc841f9e30.png"},64584:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_parameters01-5f312503b665086d8c02d9009e6f02b0.png"},988:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_posh_newaction-bfed654b1bc0efd5baa42f035aea0429.png"},66164:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_posh_newprincipal-f2f891a7988f86454900f958ff4f0a29.png"},46542:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_posh_newtrigger-2a4df83a3f2aedbd6a68dc8dd513c4ac.png"},55302:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_posh_register-5eaa05a642ff6ffa5511c846858d32cc.png"},89141:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_posh_remote01-ef50b093f8354149583ef12a4eb6bcb9.png"},47172:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_remote-36e7cf26e7430cd882f9875cb53b6d63.png"},17213:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/taskschd_trigger01-b0804a68d3ce0316080f1a7b63836829.png"},6534:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/winrm_firewall01-ab400d5132e59da13aeec10e56736035.png"},83161:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_01-4a779f1c3c5b6afaf57e2d672b46d75c.png"},25006:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_02-f6c29858e3258baf5895dbad101dabba.png"},36481:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_03-a7ba7759d639dcdce16763347172d17b.png"},59344:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_04-14a90b23a5ec976cbc34bf06cde18634.png"},17943:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_05-881d904a1c1f18076af02fced0239843.png"},68886:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/wmi_remote_06-729a728ebbb57bbbf76993d3affc053c.png"}}]);