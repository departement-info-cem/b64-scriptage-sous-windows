"use strict";(self.webpackChunkdepinfo_template=self.webpackChunkdepinfo_template||[]).push([[366],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),c=a,f=p["".concat(s,".").concat(c)]||p[c]||m[c]||o;return n?r.createElement(f,i(i({ref:t},d),{},{components:n})):r.createElement(f,i({ref:t},d))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},32231:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=n(87462),a=(n(67294),n(3905));const o={title:"Cr\xe9ation d'une for\xeat AD",slug:"ad-creation-foret",draft:!1},i="Cr\xe9ation d'une for\xeat Active Directory",l={unversionedId:"tutoriels/t01",id:"tutoriels/t01",title:"Cr\xe9ation d'une for\xeat AD",description:"Une des premi\xe8res \xe9tapes \xe0 suivre lorsqu'on construit un environnement de laboratoire Windows consiste \xe0 cr\xe9er un domaine Active Directory au sein d'une nouvelle for\xeat. Il suffit alors de proc\xe9der \xe0 la promotion d'un serveur \xe0 titre de premier contr\xf4leur de domaine de sa for\xeat. On a souvent le r\xe9flexe d'utiliser l'interface graphique, mais voici comment faire \xe0 l'aide de Windows PowerShell.",source:"@site/docs/tutoriels/t01.md",sourceDirName:"tutoriels",slug:"/tutoriels/ad-creation-foret",permalink:"/b64-scriptage-sous-windows/tutoriels/ad-creation-foret",draft:!1,tags:[],version:"current",lastUpdatedAt:1699996476,formattedLastUpdatedAt:"14 nov. 2023",frontMatter:{title:"Cr\xe9ation d'une for\xeat AD",slug:"ad-creation-foret",draft:!1},sidebar:"tutoriels",previous:{title:"Int\xe9gration Git et VS Code",permalink:"/b64-scriptage-sous-windows/tutoriels/github-vscode"},next:{title:"Installation de DHCP",permalink:"/b64-scriptage-sous-windows/tutoriels/installation-dhcp"}},s={},u=[{value:"\xc9tape 1: Changement du nom d&#39;h\xf4te",id:"\xe9tape-1-changement-du-nom-dh\xf4te",level:2},{value:"\xc9tape 2: Configuration du r\xe9seau",id:"\xe9tape-2-configuration-du-r\xe9seau",level:2},{value:"Identification de l&#39;interface",id:"identification-de-linterface",level:3},{value:"Assignation de l&#39;adresse IP",id:"assignation-de-ladresse-ip",level:3},{value:"Assignation du r\xe9solveur DNS",id:"assignation-du-r\xe9solveur-dns",level:3},{value:"\xc9tape 3: Promotion du contr\xf4leur de domaine",id:"\xe9tape-3-promotion-du-contr\xf4leur-de-domaine",level:2},{value:"Installation du r\xf4le ADDS",id:"installation-du-r\xf4le-adds",level:3},{value:"Promotion du contr\xf4leur de domaine",id:"promotion-du-contr\xf4leur-de-domaine",level:3}],d={toc:u},p="wrapper";function m(e){let{components:t,...o}=e;return(0,a.kt)(p,(0,r.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"cr\xe9ation-dune-for\xeat-active-directory"},"Cr\xe9ation d'une for\xeat Active Directory"),(0,a.kt)("p",null,"Une des premi\xe8res \xe9tapes \xe0 suivre lorsqu'on construit un environnement de laboratoire Windows consiste \xe0 cr\xe9er un domaine Active Directory au sein d'une nouvelle for\xeat. Il suffit alors de proc\xe9der \xe0 la promotion d'un serveur \xe0 titre de premier contr\xf4leur de domaine de sa for\xeat. On a souvent le r\xe9flexe d'utiliser l'interface graphique, mais voici comment faire \xe0 l'aide de Windows PowerShell."),(0,a.kt)("p",null,"Dans ce tutoriel, vous apprendrez comment cr\xe9er une nouvelle for\xeat Active Directory Domain Services en utilisant Windows PowerShell."),(0,a.kt)("h2",{id:"\xe9tape-1-changement-du-nom-dh\xf4te"},"\xc9tape 1: Changement du nom d'h\xf4te"),(0,a.kt)("p",null,"\xc0 l'installation du syst\xe8me d'exploitation, il est d'usage de modifier le nom d'h\xf4te de la machine. Le nom d'h\xf4te de Windows \xe0 son installation est g\xe9n\xe9r\xe9 al\xe9atoirement et il est pr\xe9f\xe9rable que les machines de notre environnement aient un nom repr\xe9sentatif de leur r\xf4le. Il est un bon r\xe9flexe de le faire au tout d\xe9but du processus de montage, car il est plus compliqu\xe9 changer le nom d'un syst\xe8me apr\xe8s sa promotion. Je vous recommande de le faire aussit\xf4t le syst\xe8me d'exploitation install\xe9."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},'Rename-Computer -NewName "DC01" -Restart\n')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Vous pouvez omettre le param\xe8tre ",(0,a.kt)("inlineCode",{parentName:"p"},"-Restart")," si vous voulez \xe9viter que le serveur ne red\xe9marre automatiquement.")),(0,a.kt)("h2",{id:"\xe9tape-2-configuration-du-r\xe9seau"},"\xc9tape 2: Configuration du r\xe9seau"),(0,a.kt)("p",null,"Lors de l'installation de Windows, le client DHCP est activ\xe9 par d\xe9faut tant pour l'assignation d'une adresse IP que pour ses r\xe9solveurs DNS. Il est g\xe9n\xe9ralement une bonne pratique de d\xe9sactiver le client DHCP sur les serveurs et de plut\xf4t opter pour une assignation statique."),(0,a.kt)("p",null,"On a l'habitude de voir les configurations IP et DNS comme une seule et m\xeame cat\xe9gorie de param\xe8tres, puisqu'ils sont configurables au m\xeame endroit dans l'interface graphique, mais avec PowerShell, on les configure avec deux commandes distinctes."),(0,a.kt)("h3",{id:"identification-de-linterface"},"Identification de l'interface"),(0,a.kt)("p",null,"Tout d'abord, il nous faut conna\xeetre le nom de l'interface \xe0 configurer. Par d\xe9faut, Windows attribue les noms \"Ethernet0\", \"Ethernet1\", et ainsi de suite, selon l'ordre de leur d\xe9couverte par l'\xe9num\xe9ration ",(0,a.kt)("em",{parentName:"p"},"Plug-and-Play"),". Si le serveur poss\xe8de plus d'une interface ethernet, identifiez d'abord celle qui assurera la connectivit\xe9 au r\xe9seau de production."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"Get-NetAdapter\n")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Get-NetAdapters",src:n(76032).Z,width:"882",height:"223"})),(0,a.kt)("h3",{id:"assignation-de-ladresse-ip"},"Assignation de l'adresse IP"),(0,a.kt)("p",null,"Ensuite, vous pourrez proc\xe9der \xe0 la configuration IP de cette interface. Dans cet exemple, j'ai isol\xe9 les param\xe8tres propres \xe0 l'adressage IP dans un ",(0,a.kt)("em",{parentName:"p"},"hashtable")," afin de la passer par ",(0,a.kt)("em",{parentName:"p"},"splatting"),". Assurez-vous que l'adresse IP, le masque de sous-r\xe9seau ainsi que la passerelle par d\xe9faut correspondent \xe0 votre environnement."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},'$IPAddressSplat = @{\n    IPAddress      = "192.168.21.10"\n    PrefixLength   = 24    # \xc9quivalent \xe0 255.255.255.0 (/24)\n    DefaultGateway = "192.168.21.1"\n    AddressFamily  = "IPv4"\n}\n\nNew-NetIPAddress @IPAddressSplat -InterfaceAlias "Ethernet0" \n')),(0,a.kt)("h3",{id:"assignation-du-r\xe9solveur-dns"},"Assignation du r\xe9solveur DNS"),(0,a.kt)("p",null,"Configurez finalement le r\xe9solveur DNS. Puisque ce serveur deviendra ultimement un serveur DNS \xe0 la fin du processus de promotion, on va temporairement lui affecter des r\xe9solveurs DNS publics. Ceci sera modifi\xe9 automatiquement lors de la promotion du serveur."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},'Set-DnsClientServerAddress -ServerAddresses "8.8.8.8", "8.8.4.4" -InterfaceAlias "Ethernet0"\n')),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Lorsque le serveur est promu en tant que contr\xf4leur de domaine, le r\xe9solveur DNS configur\xe9 dans l'interface r\xe9seau est automatiquement modifi\xe9 pour 127.0.0.1, l'adresse ",(0,a.kt)("em",{parentName:"p"},"loopback"),", faisant ainsi r\xe9f\xe9rence \xe0 l'h\xf4te local. Autrement dit, l'interface r\xe9seau devient un client du service DNS h\xe9berg\xe9 sur la m\xeame machine. Tous les r\xe9solveurs DNS configur\xe9s auparavant sur l'interface seront automatiquement inscrits comme redirecteurs DNS dans la configuration du serveur."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("img",{alt:"Redirecteurs DNS",src:n(20770).Z,width:"553",height:"212"}))),(0,a.kt)("h2",{id:"\xe9tape-3-promotion-du-contr\xf4leur-de-domaine"},"\xc9tape 3: Promotion du contr\xf4leur de domaine"),(0,a.kt)("h3",{id:"installation-du-r\xf4le-adds"},"Installation du r\xf4le ADDS"),(0,a.kt)("p",null,"Avant de pouvoir promouvoir le serveur comme contr\xf4leur de domaine, on doit d'abord installer le r\xf4le ",(0,a.kt)("em",{parentName:"p"},"Active Directory Domain Services"),". Plut\xf4t que de le faire par l'interface graphique, on peut le faire au moyen de cette commande PowerShell."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools\n")),(0,a.kt)("p",null,"Cette commande proc\xe8de \xe9galement \xe0 l'installation de tous les r\xf4les et fonctionnalit\xe9s connexes, incluant le module PowerShell pour Active Directory. Vous pourrez ensuite utiliser ces commandes en les important dans votre session PowerShell."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"Import-Module -Name ActiveDirectory\n")),(0,a.kt)("h3",{id:"promotion-du-contr\xf4leur-de-domaine"},"Promotion du contr\xf4leur de domaine"),(0,a.kt)("p",null,"Une fois le r\xf4le install\xe9, on peut proc\xe9der \xe0 la promotion. La commande ",(0,a.kt)("inlineCode",{parentName:"p"},"Install-ADDSForest")," permet la cr\xe9ation de la for\xeat par la promotion de son premier contr\xf4leur de domaine. Il faut fournir plusieurs arguments \xe0 la commande, l'exemple suivant les identifie dans un ",(0,a.kt)("em",{parentName:"p"},"hashtable")," pour ensuite les passer par ",(0,a.kt)("em",{parentName:"p"},"splatting"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Les param\xe8tres ",(0,a.kt)("inlineCode",{parentName:"p"},"-DomainName")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"-DomainNetbiosName"),' d\xe9signent respectivement le nom de domaine pleinement qualifi\xe9 (FQDN) du domaine et le nom NETBIOS, parfois appel\xe9 "pr\xe9-Windows 2000".')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Les param\xe8tres ",(0,a.kt)("inlineCode",{parentName:"p"},"-ForestMode")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"-DomainMode"),' d\xe9signent le niveau fonctionnel de for\xeat et de domaine respectivement. La valeur "WinThreshold" signifie le niveau fonctionnel le plus \xe9lev\xe9 pris en charge par le syst\xe8me d\'exploitation.')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Les param\xe8tres ",(0,a.kt)("inlineCode",{parentName:"p"},"-DatabasePath"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"-LogPath")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"-SysvolPath")," contr\xf4lent l'emplacement o\xf9 seront enregistr\xe9s la base de donn\xe9es (NTDS.DIT), les journaux transactionnels ainsi que le r\xe9pertoire SYSVOL qui sera r\xe9pliqu\xe9 \xe0 travers tous les contr\xf4leurs de domaine.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Le param\xe8tres ",(0,a.kt)("inlineCode",{parentName:"p"},"-InstallDNS")," est un param\xe8tre de type ",(0,a.kt)("em",{parentName:"p"},"switch")," qui d\xe9termine si le service DNS doit \xeatre install\xe9 sur ce serveur. On peut aussi activer la d\xe9l\xe9gation DNS avec le param\xe8tre ",(0,a.kt)("inlineCode",{parentName:"p"},"-CreateDnsDelegation"),". Habituellement, dans un environnement de laboratoire, on souhaite installer le service DNS mais ne pas lui configurer une d\xe9l\xe9gation.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Le param\xe8tre ",(0,a.kt)("inlineCode",{parentName:"p"},"-SafeModeAdministratorPassword")," permet de sp\xe9cifier un mot de passe pour la r\xe9cup\xe9ration d'urgence. Il doit \xeatre fourni pour activer le mode de restauration des services d'annuaire (DSRM), un sorte de mode sans \xe9chec pour contr\xf4leurs de domaine destin\xe9 \xe0 r\xe9parer ou restaurer la base de donn\xe9es Active Directory. Bien qu'il ne soit que peu utilis\xe9, il peut s'av\xe9rer n\xe9cessaire en cas de probl\xe8me, et il est important de choisir un mot de passe fort et de le garder en lieu s\xfbr (et surtout pas en texte clair). Il admet une cha\xeene s\xe9curis\xe9e (securestring) alors on doit proc\xe9der \xe0 sa conversion. Concernant le choix du mot de passe dans l'exemple suivant, on se permet bien s\xfbr des largesses, puisqu'il s'agit d'un environnement de laboratoire."))),(0,a.kt)("p",null,"Le syst\xe8me red\xe9marrera automatiquement une fois l'op\xe9ration compl\xe9t\xe9e. Pour ne pas qu'il red\xe9marre automatiquement, on peut activer le switch ",(0,a.kt)("inlineCode",{parentName:"p"},"-NoRebootOnCompletion"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},'$ADDSForestSplat = @{\n    DomainName = "ad.mondomaine.com"\n    DomainNetbiosName = "MONDOMAINE"\n    ForestMode = "WinThreshold"\n    DomainMode = "WinThreshold"\n    DatabasePath = "C:\\Windows\\NTDS"\n    LogPath = "C:\\Windows\\NTDS"\n    SysvolPath = "C:\\Windows\\SYSVOL"\n    InstallDns = $true\n    CreateDnsDelegation = $false\n    SafeModeAdministratorPassword = ConvertTo-SecureString -String "Passw0rd" -AsPlainText -Force\n}\n\nInstall-ADDSForest @ADDSForestSplat -Force\n')),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"La commande ",(0,a.kt)("inlineCode",{parentName:"p"},"Install-ADDSForest")," sert \xe0 cr\xe9er le domaine racine de sa for\xeat, et par cons\xe9quent, la for\xeat elle-m\xeame. Si on avait voulu cr\xe9er un nouveau domaine dans une for\xeat existante (par exemple, un domaine enfant), il aurait fallu utiliser la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"Install-ADDSDomain"),". Et si on avait voulu installer un contr\xf4leur de domaine au sein d'un domaine existant, alors la commande \xe0 utiliser aurait \xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},"Install-ADDSDomainController"),".")))}m.isMDXComponent=!0},20770:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/dns-redirecteurs-15a94301031329dd1d896208253e76f2.png"},76032:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/netadapters-77696ee3708d8ca47dacc09be0b7d47d.png"}}]);