<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutoriels/t01">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Création d&#x27;une forêt AD | 420-B64-EM - Scriptage sous Windows </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tutoriels/ad-creation-foret"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="keywords" content="420-B64-EM - Scriptage sous Windows , Site de référence du cours de scriptage sous Windows (formation continue), informatique, technique, cégep, cegep, édouard-montpetit, edouard-montpetit, édouard montpetit, edouard montpetit"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Création d&#x27;une forêt AD | 420-B64-EM - Scriptage sous Windows "><meta data-rh="true" name="description" content="Une des premières étapes à suivre lorsqu&#x27;on construit un environnement de laboratoire Windows consiste à créer un domaine Active Directory au sein d&#x27;une nouvelle forêt. Il suffit alors de procéder à la promotion d&#x27;un serveur à titre de premier contrôleur de domaine de sa forêt. On a souvent le réflexe d&#x27;utiliser l&#x27;interface graphique, mais voici comment faire à l&#x27;aide de Windows PowerShell."><meta data-rh="true" property="og:description" content="Une des premières étapes à suivre lorsqu&#x27;on construit un environnement de laboratoire Windows consiste à créer un domaine Active Directory au sein d&#x27;une nouvelle forêt. Il suffit alors de procéder à la promotion d&#x27;un serveur à titre de premier contrôleur de domaine de sa forêt. On a souvent le réflexe d&#x27;utiliser l&#x27;interface graphique, mais voici comment faire à l&#x27;aide de Windows PowerShell."><link data-rh="true" rel="icon" href="/b64-scriptage-sous-windows/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tutoriels/ad-creation-foret"><link data-rh="true" rel="alternate" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tutoriels/ad-creation-foret" hreflang="fr"><link data-rh="true" rel="alternate" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tutoriels/ad-creation-foret" hreflang="x-default"><link rel="stylesheet" href="/b64-scriptage-sous-windows/assets/css/styles.8f0fac2d.css">
<link rel="preload" href="/b64-scriptage-sous-windows/assets/js/runtime~main.61ea36f8.js" as="script">
<link rel="preload" href="/b64-scriptage-sous-windows/assets/js/main.7ce15393.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/b64-scriptage-sous-windows/"><div class="navbar__logo"><img src="/b64-scriptage-sous-windows/img/logo.svg" alt="Logo CEM" class="themedImage_ToTc themedImage--light_HNdA"><img src="/b64-scriptage-sous-windows/img/logo.svg" alt="Logo CEM" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">420-B64-EM - Scriptage sous Windows </b></a><a class="navbar__item navbar__link" href="/b64-scriptage-sous-windows/cours/01">Cours</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/b64-scriptage-sous-windows/tutoriels/github-classroom-simple">Tutoriels</a><a class="navbar__item navbar__link" href="/b64-scriptage-sous-windows/tp/tp1">Travaux Pratiques</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/github-classroom-simple">GitHub Classroom (simplifié)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/github-classroom-gitkraken">GitHub Classroom (GitKraken)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/github-vscode">Intégration Git et VS Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/b64-scriptage-sous-windows/tutoriels/ad-creation-foret">Création d&#x27;une forêt AD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/installation-dhcp">Installation de DHCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/dns-zone-recherche-inverse">Zone de recherche inverse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tutoriels/ad-jonction-domaine">Jonction au domaine</a></li></ul></nav><button type="button" title="Réduire le menu latéral" aria-label="Réduire le menu latéral" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/b64-scriptage-sous-windows/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Création d&#x27;une forêt AD</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><h1>Création d&#x27;une forêt Active Directory</h1><p>Une des premières étapes à suivre lorsqu&#x27;on construit un environnement de laboratoire Windows consiste à créer un domaine Active Directory au sein d&#x27;une nouvelle forêt. Il suffit alors de procéder à la promotion d&#x27;un serveur à titre de premier contrôleur de domaine de sa forêt. On a souvent le réflexe d&#x27;utiliser l&#x27;interface graphique, mais voici comment faire à l&#x27;aide de Windows PowerShell.</p><p>Dans ce tutoriel, vous apprendrez comment créer une nouvelle forêt Active Directory Domain Services en utilisant Windows PowerShell.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="étape-1-changement-du-nom-dhôte">Étape 1: Changement du nom d&#x27;hôte<a href="#étape-1-changement-du-nom-dhôte" class="hash-link" aria-label="Lien direct vers Étape 1: Changement du nom d&#x27;hôte" title="Lien direct vers Étape 1: Changement du nom d&#x27;hôte">​</a></h2><p>À l&#x27;installation du système d&#x27;exploitation, il est d&#x27;usage de modifier le nom d&#x27;hôte de la machine. Le nom d&#x27;hôte de Windows à son installation est généré aléatoirement et il est préférable que les machines de notre environnement aient un nom représentatif de leur rôle. Il est un bon réflexe de le faire au tout début du processus de montage, car il est plus compliqué changer le nom d&#x27;un système après sa promotion. Je vous recommande de le faire aussitôt le système d&#x27;exploitation installé.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Rename-Computer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">NewName </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;DC01&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_S0QG"><p>Vous pouvez omettre le paramètre <code>-Restart</code> si vous voulez éviter que le serveur ne redémarre automatiquement.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="étape-2-configuration-du-réseau">Étape 2: Configuration du réseau<a href="#étape-2-configuration-du-réseau" class="hash-link" aria-label="Lien direct vers Étape 2: Configuration du réseau" title="Lien direct vers Étape 2: Configuration du réseau">​</a></h2><p>Lors de l&#x27;installation de Windows, le client DHCP est activé par défaut tant pour l&#x27;assignation d&#x27;une adresse IP que pour ses résolveurs DNS. Il est généralement une bonne pratique de désactiver le client DHCP sur les serveurs et de plutôt opter pour une assignation statique.</p><p>On a l&#x27;habitude de voir les configurations IP et DNS comme une seule et même catégorie de paramètres, puisqu&#x27;ils sont configurables au même endroit dans l&#x27;interface graphique, mais avec PowerShell, on les configure avec deux commandes distinctes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="identification-de-linterface">Identification de l&#x27;interface<a href="#identification-de-linterface" class="hash-link" aria-label="Lien direct vers Identification de l&#x27;interface" title="Lien direct vers Identification de l&#x27;interface">​</a></h3><p>Tout d&#x27;abord, il nous faut connaître le nom de l&#x27;interface à configurer. Par défaut, Windows attribue les noms &quot;Ethernet0&quot;, &quot;Ethernet1&quot;, et ainsi de suite, selon l&#x27;ordre de leur découverte par l&#x27;énumération <em>Plug-and-Play</em>. Si le serveur possède plus d&#x27;une interface ethernet, identifiez d&#x27;abord celle qui assurera la connectivité au réseau de production.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Get-NetAdapter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Get-NetAdapters" src="/b64-scriptage-sous-windows/assets/images/netadapters-77696ee3708d8ca47dacc09be0b7d47d.png" width="882" height="223" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assignation-de-ladresse-ip">Assignation de l&#x27;adresse IP<a href="#assignation-de-ladresse-ip" class="hash-link" aria-label="Lien direct vers Assignation de l&#x27;adresse IP" title="Lien direct vers Assignation de l&#x27;adresse IP">​</a></h3><p>Ensuite, vous pourrez procéder à la configuration IP de cette interface. Dans cet exemple, j&#x27;ai isolé les paramètres propres à l&#x27;adressage IP dans un <em>hashtable</em> afin de la passer par <em>splatting</em>. Assurez-vous que l&#x27;adresse IP, le masque de sous-réseau ainsi que la passerelle par défaut correspondent à votre environnement.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">$IPAddressSplat</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    IPAddress      = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.21.10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    PrefixLength   = 24    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Équivalent à 255.255.255.0 (/24)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DefaultGateway = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;192.168.21.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    AddressFamily  = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;IPv4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">New-NetIPAddress</span><span class="token plain"> @IPAddressSplat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">InterfaceAlias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Ethernet0&quot;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assignation-du-résolveur-dns">Assignation du résolveur DNS<a href="#assignation-du-résolveur-dns" class="hash-link" aria-label="Lien direct vers Assignation du résolveur DNS" title="Lien direct vers Assignation du résolveur DNS">​</a></h3><p>Configurez finalement le résolveur DNS. Puisque ce serveur deviendra ultimement un serveur DNS à la fin du processus de promotion, on va temporairement lui affecter des résolveurs DNS publics. Ceci sera modifié automatiquement lors de la promotion du serveur.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Set-DnsClientServerAddress</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ServerAddresses </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8.8.8.8&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;8.8.4.4&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">InterfaceAlias </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Ethernet0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Lorsque le serveur est promu en tant que contrôleur de domaine, le résolveur DNS configuré dans l&#x27;interface réseau est automatiquement modifié pour 127.0.0.1, l&#x27;adresse <em>loopback</em>, faisant ainsi référence à l&#x27;hôte local. Autrement dit, l&#x27;interface réseau devient un client du service DNS hébergé sur la même machine. Tous les résolveurs DNS configurés auparavant sur l&#x27;interface seront automatiquement inscrits comme redirecteurs DNS dans la configuration du serveur.</p><p><img loading="lazy" alt="Redirecteurs DNS" src="/b64-scriptage-sous-windows/assets/images/dns-redirecteurs-15a94301031329dd1d896208253e76f2.png" width="553" height="212" class="img_ev3q"></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="étape-3-promotion-du-contrôleur-de-domaine">Étape 3: Promotion du contrôleur de domaine<a href="#étape-3-promotion-du-contrôleur-de-domaine" class="hash-link" aria-label="Lien direct vers Étape 3: Promotion du contrôleur de domaine" title="Lien direct vers Étape 3: Promotion du contrôleur de domaine">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-du-rôle-adds">Installation du rôle ADDS<a href="#installation-du-rôle-adds" class="hash-link" aria-label="Lien direct vers Installation du rôle ADDS" title="Lien direct vers Installation du rôle ADDS">​</a></h3><p>Avant de pouvoir promouvoir le serveur comme contrôleur de domaine, on doit d&#x27;abord installer le rôle <em>Active Directory Domain Services</em>. Plutôt que de le faire par l&#x27;interface graphique, on peut le faire au moyen de cette commande PowerShell.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Install-WindowsFeature</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Name AD-Domain-Services </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IncludeManagementTools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cette commande procède également à l&#x27;installation de tous les rôles et fonctionnalités connexes, incluant le module PowerShell pour Active Directory. Vous pourrez ensuite utiliser ces commandes en les important dans votre session PowerShell.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Import-Module</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Name ActiveDirectory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="promotion-du-contrôleur-de-domaine">Promotion du contrôleur de domaine<a href="#promotion-du-contrôleur-de-domaine" class="hash-link" aria-label="Lien direct vers Promotion du contrôleur de domaine" title="Lien direct vers Promotion du contrôleur de domaine">​</a></h3><p>Une fois le rôle installé, on peut procéder à la promotion. La commande <code>Install-ADDSForest</code> permet la création de la forêt par la promotion de son premier contrôleur de domaine. Il faut fournir plusieurs arguments à la commande, l&#x27;exemple suivant les identifie dans un <em>hashtable</em> pour ensuite les passer par <em>splatting</em>.</p><ul><li><p>Les paramètres <code>-DomainName</code> et <code>-DomainNetbiosName</code> désignent respectivement le nom de domaine pleinement qualifié (FQDN) du domaine et le nom NETBIOS, parfois appelé &quot;pré-Windows 2000&quot;.</p></li><li><p>Les paramètres <code>-ForestMode</code> et <code>-DomainMode</code> désignent le niveau fonctionnel de forêt et de domaine respectivement. La valeur &quot;WinThreshold&quot; signifie le niveau fonctionnel le plus élevé pris en charge par le système d&#x27;exploitation.</p></li><li><p>Les paramètres <code>-DatabasePath</code>, <code>-LogPath</code> et <code>-SysvolPath</code> contrôlent l&#x27;emplacement où seront enregistrés la base de données (NTDS.DIT), les journaux transactionnels ainsi que le répertoire SYSVOL qui sera répliqué à travers tous les contrôleurs de domaine.</p></li><li><p>Le paramètres <code>-InstallDNS</code> est un paramètre de type <em>switch</em> qui détermine si le service DNS doit être installé sur ce serveur. On peut aussi activer la délégation DNS avec le paramètre <code>-CreateDnsDelegation</code>. Habituellement, dans un environnement de laboratoire, on souhaite installer le service DNS mais ne pas lui configurer une délégation.</p></li><li><p>Le paramètre <code>-SafeModeAdministratorPassword</code> permet de spécifier un mot de passe pour la récupération d&#x27;urgence. Il doit être fourni pour activer le mode de restauration des services d&#x27;annuaire (DSRM), un sorte de mode sans échec pour contrôleurs de domaine destiné à réparer ou restaurer la base de données Active Directory. Bien qu&#x27;il ne soit que peu utilisé, il peut s&#x27;avérer nécessaire en cas de problème, et il est important de choisir un mot de passe fort et de le garder en lieu sûr (et surtout pas en texte clair). Il admet une chaîne sécurisée (securestring) alors on doit procéder à sa conversion. Concernant le choix du mot de passe dans l&#x27;exemple suivant, on se permet bien sûr des largesses, puisqu&#x27;il s&#x27;agit d&#x27;un environnement de laboratoire.</p></li></ul><p>Le système redémarrera automatiquement une fois l&#x27;opération complétée. Pour ne pas qu&#x27;il redémarre automatiquement, on peut activer le switch <code>-NoRebootOnCompletion</code>.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token variable" style="color:rgb(9, 134, 88)">$ADDSForestSplat</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DomainName = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;ad.mondomaine.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DomainNetbiosName = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;MONDOMAINE&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ForestMode = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;WinThreshold&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DomainMode = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;WinThreshold&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    DatabasePath = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;C:\Windows\NTDS&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LogPath = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;C:\Windows\NTDS&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SysvolPath = </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;C:\Windows\SYSVOL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    InstallDns = </span><span class="token boolean">$true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CreateDnsDelegation = </span><span class="token boolean">$false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SafeModeAdministratorPassword = </span><span class="token function" style="color:rgb(0, 0, 255)">ConvertTo-SecureString</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">String </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Passw0rd&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">AsPlainText </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">Install-ADDSForest</span><span class="token plain"> @ADDSForestSplat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>La commande <code>Install-ADDSForest</code> sert à créer le domaine racine de sa forêt, et par conséquent, la forêt elle-même. Si on avait voulu créer un nouveau domaine dans une forêt existante (par exemple, un domaine enfant), il aurait fallu utiliser la commande <code>Install-ADDSDomain</code>. Et si on avait voulu installer un contrôleur de domaine au sein d&#x27;un domaine existant, alors la commande à utiliser aurait été <code>Install-ADDSDomainController</code>.</p></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/b64-scriptage-sous-windows/tutoriels/github-vscode"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Intégration Git et VS Code</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/b64-scriptage-sous-windows/tutoriels/installation-dhcp"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Installation de DHCP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#étape-1-changement-du-nom-dhôte" class="table-of-contents__link toc-highlight">Étape 1: Changement du nom d&#39;hôte</a></li><li><a href="#étape-2-configuration-du-réseau" class="table-of-contents__link toc-highlight">Étape 2: Configuration du réseau</a><ul><li><a href="#identification-de-linterface" class="table-of-contents__link toc-highlight">Identification de l&#39;interface</a></li><li><a href="#assignation-de-ladresse-ip" class="table-of-contents__link toc-highlight">Assignation de l&#39;adresse IP</a></li><li><a href="#assignation-du-résolveur-dns" class="table-of-contents__link toc-highlight">Assignation du résolveur DNS</a></li></ul></li><li><a href="#étape-3-promotion-du-contrôleur-de-domaine" class="table-of-contents__link toc-highlight">Étape 3: Promotion du contrôleur de domaine</a><ul><li><a href="#installation-du-rôle-adds" class="table-of-contents__link toc-highlight">Installation du rôle ADDS</a></li><li><a href="#promotion-du-contrôleur-de-domaine" class="table-of-contents__link toc-highlight">Promotion du contrôleur de domaine</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/departement-info-cem/b64-scriptage-sous-windows" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Vincent Carrier. Tous droits réservés.</div></div></div></footer></div>
<script src="/b64-scriptage-sous-windows/assets/js/runtime~main.61ea36f8.js"></script>
<script src="/b64-scriptage-sous-windows/assets/js/main.7ce15393.js"></script>
</body>
</html>