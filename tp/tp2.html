<!doctype html>
<html lang="fr-ca" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tp/tp2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Travail pratique 2 | 420-B64-EM - Scriptage sous Windows </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tp/tp2"><meta data-rh="true" name="docusaurus_locale" content="fr-ca"><meta data-rh="true" name="docsearch:language" content="fr-ca"><meta data-rh="true" name="keywords" content="420-B64-EM - Scriptage sous Windows , Site de référence du cours de scriptage sous Windows (formation continue), informatique, technique, cégep, cegep, édouard-montpetit, edouard-montpetit, édouard montpetit, edouard montpetit"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Travail pratique 2 | 420-B64-EM - Scriptage sous Windows "><meta data-rh="true" name="description" content="Ce TP est à faire individuellement. Il compte pour 30% de la note du cours. La remise doit obligatoirement se faire par GitHub Classroom."><meta data-rh="true" property="og:description" content="Ce TP est à faire individuellement. Il compte pour 30% de la note du cours. La remise doit obligatoirement se faire par GitHub Classroom."><link data-rh="true" rel="icon" href="/b64-scriptage-sous-windows/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tp/tp2"><link data-rh="true" rel="alternate" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tp/tp2" hreflang="fr-ca"><link data-rh="true" rel="alternate" href="https://info.cegepmontpetit.ca/b64-scriptage-sous-windows/tp/tp2" hreflang="x-default"><link rel="stylesheet" href="/b64-scriptage-sous-windows/assets/css/styles.e90ab40b.css">
<link rel="preload" href="/b64-scriptage-sous-windows/assets/js/runtime~main.ebb3f1f9.js" as="script">
<link rel="preload" href="/b64-scriptage-sous-windows/assets/js/main.4c0c98db.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/b64-scriptage-sous-windows/"><div class="navbar__logo"><img src="/b64-scriptage-sous-windows/img/logo.svg" alt="Logo CEM" class="themedImage_ToTc themedImage--light_HNdA"><img src="/b64-scriptage-sous-windows/img/logo.svg" alt="Logo CEM" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">420-B64-EM - Scriptage sous Windows </b></a><a class="navbar__item navbar__link" href="/b64-scriptage-sous-windows/cours/01">Cours</a><a class="navbar__item navbar__link" href="/b64-scriptage-sous-windows/tutoriels/github-classroom-simple">Tutoriels</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/b64-scriptage-sous-windows/tp/tp1">Travaux Pratiques</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/b64-scriptage-sous-windows/tp/tp1">Travail pratique 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/b64-scriptage-sous-windows/tp/tp2">Travail pratique 2</a></li></ul></nav><button type="button" title="Réduire le menu latéral" aria-label="Réduire le menu latéral" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/b64-scriptage-sous-windows/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Travail pratique 2</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><h1>Travail pratique 2 (A2023)</h1><p>Ce TP est à faire individuellement. Il compte pour <strong>30%</strong> de la note du cours. La remise doit obligatoirement se faire par GitHub Classroom.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mandat">Mandat<a href="#mandat" class="hash-link" aria-label="Lien direct vers Mandat" title="Lien direct vers Mandat">​</a></h2><p>Vous devez implanter l’outil <a href="https://learn.microsoft.com/fr-ca/sysinternals/downloads/bginfo" target="_blank" rel="noopener noreferrer">BGInfo</a> (faisant partie de la suite <a href="https://learn.microsoft.com/fr-ca/sysinternals/" target="_blank" rel="noopener noreferrer">Sysinternals</a> de Microsoft) dans votre environnement de serveurs et de postes de travail Windows. Cet outil sert à modifier le fond d’écran pour y ajouter de l’information utile comme le nom de la machine, le domaine, le nom d’utilisateur, la configuration IP, etc.</p><p>L&#x27;outil BGInfo doit être lancé automatiquement <strong>à chaque ouverture d&#x27;une session utilisateur</strong>, afin de rafraîchir le fond d&#x27;écran avec l&#x27;information la plus récente. C&#x27;est pourquoi dans ce TP, il vous faudra réaliser deux scripts:</p><ul><li>Un <strong>script de lancement</strong> de BGInfo, qui devra être démarré automatiquement au démarrage d&#x27;une session, au moyen d&#x27;une tâche planifiée, et qui lancera l&#x27;outil BGInfo en lui chargeant le modèle approprié au type de machine et à l&#x27;utilisateur.</li><li>Un <strong>script de déploiement</strong>, qui devra créer une tâche planifiée sur une ou plusieurs machines de votre réseau (à l&#x27;aide de sessions PSRemoting);</li></ul><p><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/tp2-fichiers-3a3cd5aaad58db2235991bf7162fc473.svg" width="900" height="400" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="préparation">Préparation<a href="#préparation" class="hash-link" aria-label="Lien direct vers Préparation" title="Lien direct vers Préparation">​</a></h2><p>Voici les étapes à suivre pour vous préparer à faire ce TP:</p><ol><li><p>Assurez-vous d&#x27;avoir correctement préparé <strong>toutes les machines de votre domaine</strong> pour pouvoir exécuter des scripts (<code>Set-ExecutionPolicy RemoteSigned</code>) et pour accepter des sessions distantes (<code>Enable-PSRemoting -Force</code>).</p></li><li><p>Assurez-vous de démarrer une session avec un compte <strong>administrateur du domaine</strong> sur votre machine de développement (celle sur laquelle vous avez installé VS Code). Elle doit être membre de votre domaine. Cela peut être un poste de travail Windows 10 ou le contrôleur de domaine, peu importe.</p></li><li><p>Cliquez sur le lien GitHub Classroom qui vous a été communiqué par votre professeur et clonez le dépôt sur votre machine de développement. Vous devriez avoir ces fichiers dans le répertoire racine de votre dépôt:</p><p><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/tp2-depot-073e063f6bf49ffcbe92e86ce57aab83.svg" width="220" height="270" class="img_ev3q"></p></li><li><p>Ouvrez la racine de ce répertoire dans Visual Studio Code.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="partie-1-script-de-lancement">Partie 1: Script de lancement<a href="#partie-1-script-de-lancement" class="hash-link" aria-label="Lien direct vers Partie 1: Script de lancement" title="Lien direct vers Partie 1: Script de lancement">​</a></h2><p><strong>Nom du script: <code>bginfo.ps1</code></strong></p><p>L’outil <strong>Bginfo64.exe</strong> ainsi que trois fichiers BGI vous sont fournis pour ce TP via le lien GitHub. Les fichiers BGI décrivent comment l’outil doit se comporter, soit l’information à afficher, la couleur du fond d’écran, etc.</p><p>Pour appliquer un fichier BGI, vous devez le spécifier en paramètre à l’outil par ligne de commande. Voici la commande à utiliser, qui doit être lancée dans le contexte de l’utilisateur, <strong>à chaque fois qu&#x27;un utilisateur démarre une session</strong> :</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">&quot;C:\chemin\vers\Bginfo64.exe&quot; &quot;C:\chemin\vers\fichier.bgi&quot; /timer:0 /nolicprompt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_S0QG"><p>Dans l&#x27;exemple ci-dessus, la commande est montrée telle qu&#x27;elle devrait être écrite dans une <strong>invite de commande classique</strong> (cmd.exe). Dans un script PowerShell toutefois, l&#x27;appel de commandes externes devrait se faire à l&#x27;aide de <code>Start-Process</code>. Il est important de bien porter attention à la structure de la commande.</p><p>Dans la commande ci-dessus, le chemin menant à l&#x27;exécutable représente le programme. On le passe dans le paramètre <strong><code>FilePath</code></strong>. Les autres éléments (après le premier espace) sont des <strong>arguments</strong>. Il peut y en avoir plusieurs: <code>&quot;C:\chemin\vers\fichier.bgi&quot;</code> est un argument, <code>/timer:0</code> en est un autre et <code>/nolicprompt</code> en est un troisième. Il faut passer tous les arguments dans le paramètre <strong><code>ArgumentList</code></strong>, séparés par des virgules.</p><p>Par exemple, pour lancer la commande <code>&quot;C:\Windows\System32\ping.exe&quot; /t 127.0.0.1</code> à l&#x27;aide de la commande <code>Start-Process</code>, la syntaxe serait:</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">Start-Process</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">FilePath </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;C:\Windows\System32\ping.exe&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ArgumentList </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/t&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;127.0.0.1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>La première partie du TP consistera à développer un script qui lance la commande de l’outil BGinfo en lui fournissant un fichier BGI en fonction de deux critères :</p><ul><li>Si l’utilisateur courant est membre du groupe local des administrateurs (SID: <code>S-1-5-32-544</code>), directement ou par <em>nesting</em>.</li><li>Si la machine est un client ou un serveur. (Vous devez le vérifier par une requête WMI).</li></ul><p>*<em>Consultez la section Conseils plus bas pour savoir comment effectuer ces vérifications.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fonctionnement-du-script">Fonctionnement du script<a href="#fonctionnement-du-script" class="hash-link" aria-label="Lien direct vers Fonctionnement du script" title="Lien direct vers Fonctionnement du script">​</a></h3><p>L&#x27;algorithme principal de votre script devrait donc être semblable à celui-ci:</p><p><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/tp2-partie1-080eb5e088a54c11e0037fecb692c7ab.svg" width="1030" height="350" class="img_ev3q"></p><p>En fonction des vérifications menées par le script, celui-ci devra choisir un des trois fichiers BGI à passer en argument à Bginfo.exe. Voici l&#x27;effet des trois fichiers et la condition de leur application.</p><table><thead><tr><th>Fichier</th><th>Admin?</th><th>Type de machine</th><th>Effet</th><th>Aperçu</th></tr></thead><tbody><tr><td><code>admin.bgi</code></td><td>Oui</td><td>Peu importe</td><td>Le texte s&#x27;affiche sur <strong>fond rouge</strong> et est <strong>détaillé</strong>.</td><td><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/bgi_admin-446bc78821e266f39009054778fd0af1.png" width="331" height="102" class="img_ev3q"></td></tr><tr><td><code>client.bgi</code></td><td>Non</td><td>Poste de travail (Windows 10)</td><td>Le texte s’affiche sur le <strong>fond d’écran existant</strong> et est <strong>sommaire</strong>.</td><td><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/bgi_client-af04e86e8770b60e7058cd116bc35e03.png" width="331" height="102" class="img_ev3q"></td></tr><tr><td><code>server.bgi</code></td><td>Non</td><td>Serveur ou contrôleur de domaine (Windows Server)</td><td>Le texte s’affiche sur le <strong>fond d’écran existant</strong> et est <strong>détaillé</strong>.</td><td><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/bgi_server-606b131dc2cfe73ec216844eefa111b6.png" width="331" height="102" class="img_ev3q"></td></tr></tbody></table><p>Ce script PowerShell devra se trouver au même endroit que <code>bginfo64.exe</code> ainsi que les fichiers BGI. Il n’a pas à admettre de paramètres. Il doit simplement vérifier si l’ordinateur est un serveur ou un client, si l’utilisateur est admin ou non, et lancer la commande avec le bon fichier BGI. Vous devez utiliser la variable <code>$PSScriptRoot</code> pour vous référer à l’emplacement de votre fichier PS1.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conseils">Conseils<a href="#conseils" class="hash-link" aria-label="Lien direct vers Conseils" title="Lien direct vers Conseils">​</a></h3><ul><li><p>Voici comment vérifier si un utilisateur dispose de droits d&#x27;administration ou non. Cette méthode tient compte du <em>nesting</em> de groupes.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">whoami </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">groups </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">fo csv </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ConvertFrom-Csv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sid </span><span class="token operator" style="color:rgb(0, 0, 0)">-contains</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;S-1-5-32-544&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Pour différencier les serveurs des postes de travail (clients), intéressez-vous à la classe WMI <a href="https://learn.microsoft.com/fr-ca/windows/win32/cimwin32prov/win32-operatingsystem" target="_blank" rel="noopener noreferrer"><code>Win32_OperatingSystem</code></a></p></li><li><p>Utilisez la commande <a href="https://learn.microsoft.com/fr-ca/powershell/module/microsoft.powershell.management/start-process?view=powershell-5.1" target="_blank" rel="noopener noreferrer"><code>Start-Process</code></a> pour lancer votre commande ainsi que ses arguments.</p></li><li><p>Utilisez la variable <code>$PSScriptRoot</code> pour récupérer le chemin où se trouve votre fichier. Par exemple, si le script doit faire référence au fichier <code>Bginfo64.exe</code> situé dans le même répertoire que lui, alors son chemin pourrait être <code>$PSScriptRoot\Bginfo64.exe</code>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="partie-2-script-de-déploiement">Partie 2: Script de déploiement<a href="#partie-2-script-de-déploiement" class="hash-link" aria-label="Lien direct vers Partie 2: Script de déploiement" title="Lien direct vers Partie 2: Script de déploiement">​</a></h2><p><strong>Nom du script: <code>deploy.ps1</code></strong></p><p>L’outil BGInfo sert à afficher de l’information sur le papier peint de Windows. Une fois l’outil lancé, ce texte ne sera pas mis à jour avant que l’outil soit lancé de nouveau. Il est donc recommandé de planifier son lancement au démarrage d’une session utilisateur.</p><p>Votre mandat consiste à développer un script PowerShell pour déployer votre solution d&#x27;application de Bginfo, à distance sur une ou plusieurs machines du domaine. Ainsi, après que la solution soit déployée sur une machine, tout utilisateur qui démarre une session sur cette machine verra son fond d&#x27;écran modifié par l&#x27;outil Bginfo automatiquement.</p><p>Le script devrait s’utiliser ainsi :</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">\deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ps1 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Ordinateurs </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Serveur1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Il doit pouvoir également admettre plusieurs ordinateurs dans son paramètre <code>Ordinateurs</code>.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">\deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ps1 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Ordinateurs </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Serveur1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Serveur2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Serveur3&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fonctionnement-du-script-1">Fonctionnement du script<a href="#fonctionnement-du-script-1" class="hash-link" aria-label="Lien direct vers Fonctionnement du script" title="Lien direct vers Fonctionnement du script">​</a></h3><p>Votre script doit effectuer les tâches suivantes, <strong>pour chaque ordinateur spécifié en paramètre</strong> <em>(ça prend une boucle!)</em> :</p><ul><li><p>Établir une session PowerShell à distance à l&#x27;aide de la commande <code>New-PSSession</code>.</p></li><li><p>Créer un répertoire <code>C:\Scripts\</code> sur l&#x27;ordinateur distant à travers la session (s&#x27;il n&#x27;existe pas déjà, bien sûr).</p></li><li><p>Copier tous les fichiers de votre solution Bginfo dans le répertoire <code>C:\Scripts\Bginfo\</code> de l’ordinateur cible (soit le fichier <code>bginfo.exe</code>, tous les fichiers BGI, et votre script <code>bginfo.ps1</code> que vous avez développé préalablement). Utilisez la variable <code>$PSScriptRoot</code> pour référer au répertoire dans lequel le script est situé.</p></li><li><p>Créer une tâche planifiée sur l&#x27;ordinateur distant selon ces critères:</p><ul><li><strong>Déclencheur (<em>trigger</em>):</strong> La tâche doit être lancée automatiquement au démarrage d&#x27;une session utilisateur</li><li><strong>Action:</strong> Le lancement du script <code>bginfo.ps1</code> doit se faire au moyen de l&#x27;interpréteur <code>PowerShell.exe</code></li><li><strong>Principal:</strong> Le script doit être exécuté avec les privilèges du groupe des utilisateurs (SID: <code>S-1-5-32-545</code>)</li></ul></li></ul><p><strong>Vous devez obligatoirement utiliser des sessions PowerShell (<code>PSSession</code>) pour réaliser ce TP. N&#x27;utilisez pas <code>Enter-PSSession</code> dans un script!</strong></p><p><img loading="lazy" src="/b64-scriptage-sous-windows/assets/images/tp2-partie2-43ad5dd30920f107136eaa1ef6066723.svg" width="960" height="770" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conseils-1">Conseils<a href="#conseils-1" class="hash-link" aria-label="Lien direct vers Conseils" title="Lien direct vers Conseils">​</a></h3><ul><li><p>Utilisez la commande <code>Copy-Item</code> en spécifiant la session PSRemoting pour transférer les fichiers vers la machine distante</p></li><li><p>Stockez les fichiers dans un répertoire à la racine du script. Ainsi, vous pourrez utiliser un chemin relatif à <code>$PSScriptRoot</code> plutôt qu&#x27;un chemin absolu.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exigences-dévaluation">Exigences d&#x27;évaluation<a href="#exigences-dévaluation" class="hash-link" aria-label="Lien direct vers Exigences d&#x27;évaluation" title="Lien direct vers Exigences d&#x27;évaluation">​</a></h2><p>L’évaluation de votre travail prendra en compte les critères suivants:</p><table><thead><tr><th>Critère d&#x27;évaluation</th><th align="right">Pondération</th></tr></thead><tbody><tr><td>Partie 1: Fonctionnement du script <code>bginfo.ps1</code></td><td align="right">30%</td></tr><tr><td>Partie 2: Fonctionnement du script <code>deploy.ps1</code></td><td align="right">40%</td></tr><tr><td>Logique et conception</td><td align="right">15%</td></tr><tr><td>Style et lisibilité</td><td align="right">10%</td></tr><tr><td>Respect des consignes de remise</td><td align="right">5%</td></tr><tr><td><strong>Total</strong></td><td align="right"><strong>100%</strong></td></tr></tbody></table><p>Voici les détails de ce qui sera évalué pour chaque critère:</p><ul><li><strong>Partie 1: Fonctionnement du script <code>bginfo.ps1</code></strong> (30%)<ul><li>Toutes les fonctionnalités demandées doivent être implémentées et fonctionnelles</li><li>Aucun objet ne doit sortir sur le pipeline</li><li>Utilisation adéquate de WMI</li><li>Il ne doit pas y avoir de message d&#x27;erreur visible lors de l&#x27;exécution du script</li></ul></li><li><strong>Partie 2: Fonctionnement du script <code>deploy.ps1</code></strong> (40%)<ul><li>Toutes les fonctionnalités demandées doivent être implémentées et fonctionnelles</li><li>Définition adéquate du paramètre</li><li>Prise en charge de plusieurs machines à la fois</li><li>Gestion de la session PSRemoting et utilisation de cette session pour toutes les opérations sur la machine distante</li><li>Création du répertoire distant si nécessaire</li><li>Copie de fichiers à travers la session</li><li>Création de la tâche planifiée</li><li>Aucun objet ne doit sortir sur le pipeline</li></ul></li><li><strong>Logique et conception</strong> (15%)<ul><li>Votre code doit être logique et éviter des tournures redondantes ou inutiles</li><li>Éviter les chemins absolus et <em>hard-codés</em> (particulièrement ceux vers un profil utilisateur)</li><li>Le nom des commandes, des paramètres ainsi que la structure des objets doivent être conformes aux spécifications de l’énoncé</li></ul></li><li><strong>Style et lisibilité</strong> (10%)<ul><li>Les noms des variables et des fonctions doit être représentatif</li><li>Les commentaires doivent être pertinents</li><li>Le code doit être correctement indenté</li></ul></li><li><strong>Respect des consignes de remise</strong> (5%)<ul><li>La remise a été faite sur GitHub tel que demandé</li><li>Toutes les consignes sont respectées</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Dernière mise à jour<!-- --> le <b><time datetime="2023-11-14T21:38:45.000Z">14 nov. 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/b64-scriptage-sous-windows/tp/tp1"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Travail pratique 1</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mandat" class="table-of-contents__link toc-highlight">Mandat</a></li><li><a href="#préparation" class="table-of-contents__link toc-highlight">Préparation</a></li><li><a href="#partie-1-script-de-lancement" class="table-of-contents__link toc-highlight">Partie 1: Script de lancement</a><ul><li><a href="#fonctionnement-du-script" class="table-of-contents__link toc-highlight">Fonctionnement du script</a></li><li><a href="#conseils" class="table-of-contents__link toc-highlight">Conseils</a></li></ul></li><li><a href="#partie-2-script-de-déploiement" class="table-of-contents__link toc-highlight">Partie 2: Script de déploiement</a><ul><li><a href="#fonctionnement-du-script-1" class="table-of-contents__link toc-highlight">Fonctionnement du script</a></li><li><a href="#conseils-1" class="table-of-contents__link toc-highlight">Conseils</a></li></ul></li><li><a href="#exigences-dévaluation" class="table-of-contents__link toc-highlight">Exigences d&#39;évaluation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/departement-info-cem/b64-scriptage-sous-windows" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Vincent Carrier. Tous droits réservés.</div></div></div></footer></div>
<script src="/b64-scriptage-sous-windows/assets/js/runtime~main.ebb3f1f9.js"></script>
<script src="/b64-scriptage-sous-windows/assets/js/main.4c0c98db.js"></script>
</body>
</html>